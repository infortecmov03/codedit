<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeMobile - Editor de C√≥digo</title>
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0e639c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=">

<!-- Icons -->
<link rel="icon" type="image/png" href="icon-192.png">
<link rel="apple-touch-icon" href="icon-192.png">

<!-- Snippets Library -->
<script src="snippets.js"></script>
    <link rel="stylesheet" href="styles.css">
    <!-- Prism.js para syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css">
    <!-- Adicione no head -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/php/php.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/sql/sql.min.js"></script>
<style>
    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background-color: #1e1e1e;
    color: #f0f0f0;
    height: 100vh;
    overflow: hidden;
}

.container {
    display: flex;
    flex-direction: column;
    height: 100vh;
}

/* Header */
.header {
    padding: 12px 15px;
    background-color: #2d2d30;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid #3e3e42;
}

.header-left {
    display: flex;
    align-items: center;
    gap: 15px;
}

.hamburger-menu {
    background: none;
    border: none;
    color: #569cd6;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 5px;
}

.header h1 {
    font-size: 1.2rem;
    color: #569cd6;
}

.header-controls {
    display: flex;
    gap: 8px;
}

/* Bot√µes */
.btn {
    background-color: #0e639c;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    font-size: 0.9rem;
    min-height: 36px;
    -webkit-tap-highlight-color: transparent;
}

.btn:active {
    opacity: 0.8;
    transform: scale(0.98);
}

.btn-save {
    background-color: #0e639c;
}

.btn-preview {
    background-color: #388a34;
}

.btn-new {
    background-color: #68217a;
}

.btn-danger {
    background-color: #da3633;
}

.btn-warning {
    background-color: #b89500;
}

/* Layout Principal */
.main-content {
    display: flex;
    flex: 1;
    overflow: hidden;
}

/* Sidebar */
.sidebar {
    width: 280px;
    background-color: #252526;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: absolute;
    height: 100%;
    z-index: 1000;
}

.sidebar.active {
    transform: translateX(0);
}

.sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    border-bottom: 1px solid #3e3e42;
}

.sidebar h2 {
    font-size: 1.1rem;
    color: #569cd6;
}

.sidebar-content {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
}

.sidebar-section {
    margin-bottom: 20px;
}

.sidebar-section h3 {
    font-size: 0.9rem;
    color: #cccccc;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px solid #3e3e42;
}

.storage-info {
    background-color: #2d2d30;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 15px;
}

.storage-info p {
    font-size: 0.8rem;
    margin-bottom: 5px;
}

.permission-status {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
}

.status-indicator {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: #da3633;
}

.status-indicator.granted {
    background-color: #388a34;
}

/* Itens de pasta e arquivo */
.folder-item, .file-item {
    padding: 12px 10px;
    margin-bottom: 5px;
    background-color: #2d2d30;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    min-height: 44px;
    -webkit-tap-highlight-color: transparent;
}

.folder-item.active, .file-item.active {
    background-color: #0e639c;
}

.folder-item:active, .file-item:active {
    background-color: #464647;
    transform: scale(0.98);
}

.folder-actions, .file-actions {
    display: flex;
    gap: 5px;
}

.folder-icon {
    margin-right: 8px;
}

.file-list {
    margin-top: 10px;
}

.file-item {
    padding: 10px;
    background-color: #3c3c3c;
    font-size: 0.9rem;
}

.file-item.active {
    background-color: #37373d;
    border-left: 3px solid #0e639c;
}

/* √Årea do Editor */
.editor-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    background-color: #252526;
    overflow: hidden;
    transition: margin-left 0.3s ease;
}

.editor-container.sidebar-open {
    margin-left: 280px;
}

.editor-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    background-color: #2d2d30;
    border-bottom: 1px solid #3e3e42;
}

.current-file {
    font-size: 0.9rem;
    color: #cccccc;
}

.code-tabs {
    display: flex;
    background-color: #2d2d30;
    padding: 5px 5px 0;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

.code-tab {
    padding: 12px 16px;
    background-color: #2d2d30;
    border: none;
    color: #cccccc;
    cursor: pointer;
    border-radius: 4px 4px 0 0;
    font-size: 0.9rem;
    white-space: nowrap;
    min-height: 44px;
    -webkit-tap-highlight-color: transparent;
}

.code-tab.active {
    background-color: #1e1e1e;
    color: #ffffff;
}

.code-tab:active {
    background-color: #464647;
}

.code-editor {
    flex: 1;
    padding: 15px;
    background-color: #1e1e1e;
    color: #d4d4d4;
    border: none;
    resize: none;
    font-family: 'Courier New', monospace;
    font-size: 16px;
    line-height: 1.5;
    outline: none;
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
}

.hidden {
    display: none !important;
}

/* Preview e Console */
.preview-area {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #252526;
    z-index: 100;
    display: none;
    flex-direction: column;
}

.preview-area.active {
    display: flex;
}

.preview-header {
    padding: 12px 15px;
    background-color: #2d2d30;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #3e3e42;
}

.preview-header h2 {
    font-size: 1rem;
    color: #569cd6;
}

.preview-container {
    flex: 1;
    background-color: white;
    border: none;
}

.console-area {
    height: 150px;
    background-color: #1e1e1e;
    border-top: 1px solid #3e3e42;
    overflow-y: auto;
    padding: 10px;
    font-family: 'Courier New', monospace;
    font-size: 12px;
}

.console-log {
    color: #cccccc;
    margin-bottom: 5px;
}

.console-error {
    color: #f44747;
    margin-bottom: 5px;
}

.console-warn {
    color: #ffcc02;
    margin-bottom: 5px;
}

/* Overlay e Modais */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 999;
    display: none;
}

.overlay.active {
    display: block;
}

.modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #2d2d30;
    padding: 20px;
    border-radius: 8px;
    z-index: 1001;
    display: none;
    min-width: 300px;
    max-width: 90vw;
}

.modal.active {
    display: block;
}

.modal h3 {
    margin-bottom: 15px;
    color: #569cd6;
}

.modal-input {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    background-color: #3c3c3c;
    border: 1px solid #464647;
    border-radius: 4px;
    color: white;
    font-size: 16px;
}

.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.empty-state {
    text-align: center;
    padding: 20px;
    color: #888;
    font-size: 0.9rem;
}

.icon-btn {
    background: none;
    border: none;
    color: #cccccc;
    cursor: pointer;
    padding: 8px;
    border-radius: 3px;
    font-size: 0.9rem;
    min-height: 36px;
    min-width: 36px;
    -webkit-tap-highlight-color: transparent;
}

.icon-btn:active {
    background-color: #464647;
    transform: scale(0.95);
}

/* Menu de A√ß√µes R√°pidas */
.quick-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    flex-wrap: wrap;
}

.quick-btn {
    flex: 1;
    min-width: 120px;
    background-color: #3c3c3c;
    border: none;
    color: #cccccc;
    padding: 12px 8px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.8rem;
    text-align: center;
    min-height: 44px;
    -webkit-tap-highlight-color: transparent;
}

.quick-btn:active {
    background-color: #464647;
    transform: scale(0.98);
}

/* ===== MELHORIAS MOBILE ===== */

/* Prevenir sele√ß√£o acidental em elementos interativos */
.btn, .code-tab, .folder-item, .file-item, .icon-btn, .quick-btn {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* Otimiza√ß√µes para telas pequenas */
@media (max-width: 768px) {
    .container {
        height: 100vh;
        overflow: hidden;
    }
    
    .header {
        padding: 8px 12px;
    }
    
    .header h1 {
        font-size: 1.1rem;
    }
    
    .header-controls {
        gap: 6px;
    }
    
    .btn {
        padding: 10px 12px;
        font-size: 0.85rem;
        min-height: 40px;
    }
    
    /* Sidebar mobile otimizada */
    .sidebar {
        width: 85vw;
        transform: translateX(-100%);
    }
    
    .sidebar.active {
        transform: translateX(0);
    }
    
    .sidebar-header {
        padding: 12px;
    }
    
    .sidebar-content {
        padding: 8px;
    }
    
    /* Editor em tela cheia quando sidebar fechada */
    .editor-container.sidebar-open {
        margin-left: 0;
        width: 100%;
    }
    
    /* Abas de c√≥digo otimizadas */
    .code-tabs {
        flex-wrap: nowrap;
        overflow-x: auto;
        padding: 4px;
    }
    
    .code-tab {
        padding: 12px 16px;
        font-size: 0.85rem;
        min-height: 44px;
    }
    
    /* Editor com fonte adequada para mobile */
    .code-editor {
        font-size: 16px;
        line-height: 1.4;
        padding: 12px;
    }
    
    /* Preview em tela cheia */
    .preview-area {
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        border-radius: 0;
    }
    
    .preview-header {
        padding: 10px 12px;
    }
    
    /* Modais otimizados */
    .modal {
        width: 90vw;
        max-width: 400px;
        padding: 20px;
    }
    
    .modal-input {
        font-size: 16px;
        padding: 14px;
    }
    
    /* A√ß√µes r√°pidas em coluna */
    .quick-actions {
        grid-template-columns: 1fr;
        gap: 8px;
    }
    
    .quick-btn {
        min-width: auto;
        padding: 14px 8px;
    }
    
    /* Console com altura adequada */
    .console-area {
        height: 30vh;
        max-height: 200px;
    }
}

/* Melhorias espec√≠ficas para telas muito pequenas */
@media (max-width: 480px) {
    .header h1 {
        font-size: 1rem;
    }
    
    .btn {
        padding: 8px 10px;
        font-size: 0.8rem;
    }
    
    .sidebar {
        width: 90vw;
    }
    
    .code-tab {
        padding: 10px 14px;
        font-size: 0.8rem;
    }
    
    .quick-actions {
        grid-template-columns: 1fr;
    }
    
    .folder-item, .file-item {
        padding: 14px 10px;
    }
}

/* Otimiza√ß√µes para orienta√ß√£o landscape */
@media (max-height: 500px) and (orientation: landscape) {
    .editor-container {
        height: 70vh;
    }
    
    .code-editor {
        font-size: 14px;
    }
    
    .header {
        padding: 6px 10px;
    }
    
    .sidebar-content {
        padding: 6px;
    }
}

/* Estados para orienta√ß√£o */
body.landscape .editor-container {
    height: calc(100vh - 50px);
}

body.portrait .editor-container {
    height: calc(100vh - 120px);
}

/* Loading spinner para opera√ß√µes mobile */
.loading-spinner {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000;
    background: rgba(0, 0, 0, 0.8);
    padding: 20px;
    border-radius: 8px;
    color: white;
}

.loading-spinner.active {
    display: block;
}

/* Melhor feedback visual para toque em dispositivos com touch */
@media (hover: none) and (pointer: coarse) {
    .btn:hover, 
    .code-tab:hover, 
    .folder-item:hover, 
    .file-item:hover,
    .icon-btn:hover,
    .quick-btn:hover {
        transform: none;
    }
    
    .btn:active, 
    .code-tab:active, 
    .folder-item:active, 
    .file-item:active,
    .icon-btn:active,
    .quick-btn:active {
        transform: scale(0.98);
        opacity: 0.9;
    }
}

/* Garantir que elementos cr√≠ticos sejam vis√≠veis */
@media (max-width: 768px) {
    .header-controls {
        flex-shrink: 0;
    }
    
    .header-left {
        flex-shrink: 1;
        min-width: 0;
    }
    
    .header h1 {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
}

/* Adicione estas cores espec√≠ficas para as abas ap√≥s o .code-tab existente */

.code-tab[data-tab="python"] {
    border-left: 3px solid #3572A5;
}

.code-tab[data-tab="php"] {
    border-left: 3px solid #4F5D95;
}

.code-tab[data-tab="sql"] {
    border-left: 3px solid #e38c00;
}

.code-tab[data-tab="json"] {
    border-left: 3px solid #f5de19;
}

.code-tab[data-tab="markdown"] {
    border-left: 3px solid #083fa1;
}

/* Destaque de sintaxe b√°sico para mobile */
@media (max-width: 768px) {
    .code-tab {
        border-left: 3px solid transparent;
    }
    
    .code-tab.active[data-tab="python"] {
        border-left-color: #3572A5;
    }
    
    .code-tab.active[data-tab="php"] {
        border-left-color: #4F5D95;
    }
    
    .code-tab.active[data-tab="sql"] {
        border-left-color: #e38c00;
    }
    
    .code-tab.active[data-tab="json"] {
        border-left-color: #f5de19;
    }
    
    .code-tab.active[data-tab="markdown"] {
        border-left-color: #083fa1;
    }
}

/* ... (mantenha todo o CSS anterior) ... */

/* ===== NOVOS ESTILOS ===== */

/* Tema Claro */
body.light-theme {
    --primary-color: #007acc;
    --secondary-color: #f3f3f3;
    --accent-color: #005a9e;
    --background-color: #ffffff;
    --sidebar-bg: #f8f8f8;
    --editor-bg: #ffffff;
    --text-color: #333333;
    --text-muted: #666666;
    --border-color: #e1e1e1;
    --success-color: #28a745;
    --warning-color: #ffc107;
    --danger-color: #dc3545;
    --hover-color: #e9e9e9;
}

/* Bot√£o de Tema */
.btn-theme {
    background-color: var(--secondary-color);
    color: var(--text-color);
}

/* Barra de Busca */
.search-container {
    margin-bottom: 15px;
}

.search-input {
    width: 100%;
    padding: 12px;
    background-color: var(--sidebar-bg);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    color: var(--text-color);
    font-size: 14px;
}

/* Editor com Syntax Highlighting */
.editor-wrapper {
    flex: 1;
    position: relative;
    overflow: auto;
}

.editor-wrapper pre {
    margin: 0;
    height: 100%;
    background-color: var(--editor-bg) !important;
}

.editor-wrapper code {
    font-family: 'Courier New', monospace !important;
    font-size: 14px !important;
    line-height: 1.5 !important;
    tab-size: 4 !important;
}

.code-editor {
    display: block;
    width: 100%;
    height: 100%;
    padding: 15px;
    border: none;
    resize: none;
    outline: none;
    background: transparent !important;
    white-space: pre-wrap !important;
    word-break: break-all !important;
}

/* Line Numbers */
.line-numbers .line-numbers-rows {
    border-right: 1px solid var(--border-color) !important;
}

.line-numbers-rows > span:before {
    color: var(--text-muted) !important;
}

/* Barra de Busca no C√≥digo */
.find-replace-bar {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    background-color: var(--secondary-color);
    border-top: 1px solid var(--border-color);
    gap: 8px;
}

.find-input {
    flex: 1;
    padding: 8px;
    background-color: var(--editor-bg);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    color: var(--text-color);
    font-size: 14px;
}

/* A√ß√µes do Editor */
.editor-actions {
    display: flex;
    gap: 8px;
}

/* Modal GitHub */
.github-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 15px;
}

.github-btn {
    background-color: #333;
    color: white;
}

.github-btn:hover {
    background-color: #555;
}

.github-settings {
    margin-bottom: 15px;
}

/* Modal Snippets */
.modal-large {
    max-width: 500px;
}

.snippets-categories {
    display: flex;
    gap: 8px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.snippet-category {
    padding: 8px 12px;
    background-color: var(--secondary-color);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    color: var(--text-color);
    cursor: pointer;
    font-size: 12px;
}

.snippet-category.active {
    background-color: var(--primary-color);
    color: white;
}

.snippets-list {
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 15px;
}

.snippet-item {
    padding: 12px;
    margin-bottom: 8px;
    background-color: var(--secondary-color);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.snippet-item:hover {
    background-color: var(--hover-color);
}

.snippet-title {
    font-weight: bold;
    margin-bottom: 5px;
    color: var(--primary-color);
}

.snippet-description {
    font-size: 12px;
    color: var(--text-muted);
    margin-bottom: 8px;
}

.snippet-code {
    background-color: var(--editor-bg);
    padding: 8px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    overflow-x: auto;
}

/* Destaque para busca */
.highlight {
    background-color: yellow;
    color: black;
}

.search-match {
    background-color: #ffeb3b;
    color: #000;
}

/* Ajustes para Prism.js no tema claro */
body.light-theme .token.comment,
body.light-theme .token.prolog,
body.light-theme .token.doctype,
body.light-theme .token.cdata {
    color: #708090;
}

body.light-theme .token.punctuation {
    color: #999;
}

body.light-theme .token.property,
body.light-theme .token.tag,
body.light-theme .token.boolean,
body.light-theme .token.number,
body.light-theme .token.constant,
body.light-theme .token.symbol,
body.light-theme .token.deleted {
    color: #905;
}

body.light-theme .token.selector,
body.light-theme .token.attr-name,
body.light-theme .token.string,
body.light-theme .token.char,
body.light-theme .token.builtin,
body.light-theme .token.inserted {
    color: #690;
}

body.light-theme .token.operator,
body.light-theme .token.entity,
body.light-theme .token.url,
body.light-theme .language-css .token.string,
body.light-theme .style .token.string {
    color: #9a6e3a;
}

/* Loading States */
.loading {
    opacity: 0.7;
    pointer-events: none;
}

.loading::after {
    content: ' ‚åõ';
}

/* Anima√ß√µes Suaves */
.fade-in {
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Responsividade para novos elementos */
@media (max-width: 768px) {
    .editor-actions {
        gap: 6px;
    }
    
    .find-replace-bar {
        padding: 6px 8px;
    }
    
    .find-input {
        font-size: 16px; /* Prevenir zoom no iOS */
    }
    
    .snippets-categories {
        justify-content: center;
    }
    
    .snippet-category {
        flex: 1;
        min-width: 80px;
        text-align: center;
    }
    
    .github-actions {
        flex-direction: column;
    }
    
    .modal-large {
        width: 95vw;
        max-width: 95vw;
    }
}

/* Melhorias para acessibilidade */
@media (prefers-reduced-motion: reduce) {
    .fade-in {
        animation: none;
    }
}

/* Foco vis√≠vel para acessibilidade */
.btn:focus-visible,
.code-tab:focus-visible,
.search-input:focus-visible,
.find-input:focus-visible {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
}


/* Estilos para os novos bot√µes de import/export */
.quick-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-top: 10px;
}

@media (max-width: 768px) {
    .quick-actions {
        grid-template-columns: 1fr;
    }
}

/* Garantir que o input file fique vis√≠vel */
#importFileInput {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    background-color: #3c3c3c;
    border: 1px solid #464647;
    border-radius: 4px;
    color: white;
}
/* Adicionar ao CSS */
@media (max-width: 480px) {
    .code-tabs {
        flex-wrap: wrap;
    }
    
    .code-tab {
        flex: 1 0 45%;
        font-size: 0.8rem;
        padding: 10px 8px;
    }
}
/* Indicador de arquivo n√£o salvo */
.file-item.unsaved::after {
    content: " ‚óè";
    color: #ff6b6b;
    font-weight: bold;
}

/* Loading states melhorados */
.saving::after {
    content: " üíæ";
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

/* Estilos para o modal de snippets */
.snippets-categories {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.snippets-categories button {
    padding: 8px 16px;
    border: 1px solid #444;
    background: #2d2d2d;
    color: #fff;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s;
}

.snippets-categories button.active {
    background: #0e639c;
    border-color: #0e639c;
}

.snippets-categories button:hover {
    background: #444;
}

.snippets-container {
    max-height: 400px;
    overflow-y: auto;
}

.snippet-item {
    background: #2d2d2d;
    border: 1px solid #444;
    border-radius: 4px;
    padding: 15px;
    margin-bottom: 15px;
    cursor: pointer;
    transition: all 0.3s;
}

.snippet-item:hover {
    border-color: #0e639c;
    transform: translateY(-2px);
}

.snippet-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.snippet-header h4 {
    margin: 0;
    color: #fff;
    font-size: 1.1em;
}

.insert-snippet {
    background: #388a34;
    border: none;
    padding: 5px 10px;
    border-radius: 3px;
    cursor: pointer;
    font-size: 0.9em;
}

.snippet-description {
    color: #ccc;
    margin-bottom: 10px;
    font-size: 0.9em;
}

.snippet-code {
    background: #1e1e1e;
    padding: 10px;
    border-radius: 4px;
    margin: 0;
    font-size: 0.8em;
}

.snippet-code code {
    background: none;
    color: #d4d4d4;
}

/* Tema claro para snippets */
.light-theme .snippets-categories button {
    background: #f0f0f0;
    border-color: #ddd;
    color: #333;
}

.light-theme .snippets-categories button.active {
    background: #007acc;
    color: white;
}

.light-theme .snippet-item {
    background: #f8f8f8;
    border-color: #ddd;
}

.light-theme .snippet-header h4 {
    color: #333;
}

.light-theme .snippet-description {
    color: #666;
}

.light-theme .snippet-code {
    background: #f5f5f5;
}

.light-theme .snippet-code code {
    color: #333;
}

/* Corre√ß√£o para acessibilidade ARIA */
.sidebar[aria-hidden="true"] {
    display: none;
}

.sidebar[aria-hidden="false"] {
    display: flex;
}

/* Garantir que elementos com foco n√£o sejam escondidos */
.sidebar:not([aria-hidden="true"]) *:focus {
    outline: 2px solid #0e639c;
    outline-offset: 2px;
}

/* Adicionar ao styles.css */
.snippet-item {
    background: #2d2d2d;
    border: 1px solid #444;
    border-radius: 4px;
    padding: 15px;
    margin-bottom: 15px;
    cursor: pointer;
}

.snippet-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.insert-snippet {
    background: #388a34;
    border: none;
    padding: 5px 10px;
    border-radius: 3px;
    cursor: pointer;
}
</style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <button class="hamburger-menu" id="hamburgerBtn">‚ò∞</button>
                <h1>CodeMobile</h1>
            </div>
            <div class="header-controls">
                <button class="btn btn-theme" id="themeBtn">üåô</button>
                <button class="btn btn-save" id="saveBtn">Salvar</button>
                <button class="btn btn-preview" id="previewBtn">Preview</button>
            </div>
        </div>
        
        <div class="main-content">
            <!-- Sidebar com Menu Hamb√∫rguer -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h2>Explorador de Arquivos</h2>
                    <button class="icon-btn" id="closeSidebar">‚úï</button>
                </div>
                
                <div class="sidebar-content">
                    <!-- Busca -->
                    <div class="sidebar-section">
                        <div class="search-container">
                            <input type="text" id="fileSearch" placeholder="üîç Buscar arquivos..." class="search-input">
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>Armazenamento</h3>
                        <div class="storage-info">
                            <p>Status Permiss√£o:</p>
                            <div class="permission-status">
                                <div class="status-indicator" id="permissionIndicator"></div>
                                <span id="permissionText">N√£o concedida</span>
                            </div>
                            <button class="btn btn-warning" id="requestPermissionBtn" style="width: 100%; margin-top: 10px;">
                                üóÇÔ∏è Selecionar Pasta
                            </button>
                        </div>
    
                        <div class="quick-actions">
                            <button class="quick-btn" id="newFolderBtn">üìÅ Nova Pasta</button>
                            <button class="quick-btn" id="newFileBtn">üìÑ Novo Arquivo</button>
                            <button class="quick-btn" id="refreshBtn">üîÑ Atualizar</button>
                            <button class="quick-btn" id="exportBtn">üì§ Exportar</button>
                            <button class="quick-btn" id="importBtn">üì• Importar</button>
                            <button class="quick-btn" id="githubBtn">üêô GitHub</button>
                            <button class="quick-btn" id="snippetsBtn">üìã Snippets</button>
                           
                        </div>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3>Pastas do Projeto</h3>
                        <div class="folder-list" id="folderList">
                            <!-- Pastas ser√£o carregadas aqui -->
                        </div>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3 id="currentFolderTitle">Arquivos</h3>
                        <div class="file-list" id="fileList">
                            <!-- Arquivos da pasta selecionada ser√£o carregados aqui -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- √Årea do Editor -->
<div class="editor-container" id="editorContainer">
    <div class="editor-header">
        <div class="current-file" id="currentFile">Nenhum arquivo selecionado</div>
        <div class="editor-actions">
            <button class="icon-btn" id="formatBtn" title="Formatar c√≥digo">‚ú®</button>
            <button class="icon-btn" id="findBtn" title="Buscar no c√≥digo">üîç</button>
        </div>
    </div>
    <div class="code-tabs">
        <button class="code-tab active" data-tab="html">HTML</button>
        <button class="code-tab" data-tab="css">CSS</button>
        <button class="code-tab" data-tab="js">JavaScript</button>
        <button class="code-tab" data-tab="python">Python</button>
        <button class="code-tab" data-tab="php">PHP</button>
        <button class="code-tab" data-tab="sql">SQL</button>
        <button class="code-tab" data-tab="json">JSON</button>
        <button class="code-tab" data-tab="markdown">Markdown</button>
    </div>
    
    <!-- EDITORES DE C√ìDIGO -->
<div class="editor-wrapper">
    <textarea class="code-editor" id="htmlEditor" placeholder="Digite seu c√≥digo HTML aqui..."></textarea>
    <textarea class="code-editor hidden" id="cssEditor" placeholder="Digite seu c√≥digo CSS aqui..."></textarea>
    <textarea class="code-editor hidden" id="jsEditor" placeholder="Digite seu c√≥digo JavaScript aqui..."></textarea>
    <textarea class="code-editor hidden" id="pythonEditor" placeholder="Digite seu c√≥digo Python aqui..."></textarea>
    <textarea class="code-editor hidden" id="phpEditor" placeholder="Digite seu c√≥digo PHP aqui..."></textarea>
    <textarea class="code-editor hidden" id="sqlEditor" placeholder="Digite seu c√≥digo SQL aqui..."></textarea>
    <textarea class="code-editor hidden" id="jsonEditor" placeholder="Digite seu JSON aqui..."></textarea>
    <textarea class="code-editor hidden" id="markdownEditor" placeholder="Digite seu Markdown aqui..."></textarea>
</div>

    <!-- Barra de busca no c√≥digo -->
    <div class="find-replace-bar hidden" id="findBar">
        <input type="text" id="findInput" placeholder="Buscar no c√≥digo..." class="find-input">
        <button class="icon-btn" id="findPrevBtn">‚¨ÜÔ∏è</button>
        <button class="icon-btn" id="findNextBtn">‚¨áÔ∏è</button>
        <button class="icon-btn" id="closeFindBtn">‚úï</button>
    </div>
</div>
    
    <!-- Overlay e Modais -->
    <div class="overlay" id="overlay"></div>
    
    <!-- Preview Area -->
    <div class="preview-area" id="previewArea">
        <div class="preview-header">
            <h2>Preview</h2>
            <button class="btn btn-danger" id="closeBtn">Fechar</button>
        </div>
        <iframe class="preview-container" id="previewFrame"></iframe>
        <div class="console-area" id="consoleOutput">
            <div class="console-log">Console pronto. Clique em "Preview" para ver o resultado.</div>
        </div>
    </div>
    
    <!-- Modal GitHub -->
    <div class="modal" id="githubModal">
        <h3>üêô Integra√ß√£o GitHub</h3>
        <div class="github-actions">
            <button class="btn github-btn" id="githubImportBtn">üì• Importar do GitHub</button>
            <button class="btn github-btn" id="githubExportBtn">üì§ Exportar para GitHub</button>
        </div>
        <div class="github-settings hidden" id="githubSettings">
            <input type="text" id="githubRepo" placeholder="usu√°rio/reposit√≥rio" class="modal-input">
            <input type="password" id="githubToken" placeholder="Token GitHub (opcional)" class="modal-input">
            <small style="color: var(--text-secondary); display: block; margin-bottom: 15px; font-size: 0.8rem;">
                ‚ö†Ô∏è Conex√£o com internet necess√°ria. Token s√≥ √© necess√°rio para reposit√≥rios privados.
            </small>
            <div class="modal-actions">
                <button class="btn btn-danger" id="cancelGithubBtn">Cancelar</button>
                <button class="btn btn-save" id="confirmGithubBtn">Salvar</button>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn btn-danger" id="closeGithubBtn">Fechar</button>
        </div>
    </div>
    
    <!-- Modal Snippets -->
    <div class="modal modal-large" id="snippetsModal">
        <h3>üìã Snippets de C√≥digo</h3>
        <div class="snippets-categories">
            <button class="snippet-category active" data-category="html">HTML</button>
            <button class="snippet-category" data-category="css">CSS</button>
            <button class="snippet-category" data-category="js">JavaScript</button>
            <button class="snippet-category" data-category="python">Python</button>
        </div>
        <div class="snippets-list" id="snippetsList">
            <!-- Snippets ser√£o carregados aqui -->
        </div>
        <div class="modal-actions">
            <button class="btn btn-danger" id="closeSnippetsBtn">Fechar</button>
        </div>
    </div>
    
    <!-- Modais existentes (folderModal, fileModal) -->
    <div class="modal" id="folderModal">
        <h3>Nova Pasta</h3>
        <input type="text" class="modal-input" id="folderNameInput" placeholder="Nome da pasta">
        <div class="modal-actions">
            <button class="btn btn-danger" id="cancelFolderBtn">Cancelar</button>
            <button class="btn btn-save" id="confirmFolderBtn">Criar</button>
        </div>
    </div>
    <!-- Adicione estes elementos antes do fechamento do body -->
    <div class="modal" id="importModal">
        <h3>Importar Arquivos</h3>
        <input type="file" id="importFileInput" multiple accept=".html,.css,.js,.txt,.json,.py,.php,.sql,.md" class="modal-input">
        <div class="modal-actions">
            <button class="btn btn-danger" id="cancelImportBtn">Cancelar</button>
            <button class="btn btn-save" id="confirmImportBtn">Importar</button>
        </div>
    </div>

    
    <div class="modal" id="fileModal">
        <h3>Novo Arquivo</h3>
        <input type="text" class="modal-input" id="fileNameInput" placeholder="Nome do arquivo (sem extens√£o)">
        <div class="modal-actions">
            <button class="btn btn-danger" id="cancelFileBtn">Cancelar</button>
            <button class="btn btn-save" id="confirmFileBtn">Criar</button>
        </div>
    </div>

    <script>
        // snippets.js
const codeSnippets = {
    html: [
        {
            title: "Estrutura HTML B√°sica",
            description: "Estrutura b√°sica de um documento HTML5",
            code: `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
</body>
</html>`
        },
        {
            title: "Formul√°rio de Contato",
            description: "Formul√°rio de contato responsivo",
            code: `<form class="contact-form">
    <div class="form-group">
        <label for="name">Nome:</label>
        <input type="text" id="name" name="name" required>
    </div>
    <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
    </div>
    <div class="form-group">
        <label for="message">Mensagem:</label>
        <textarea id="message" name="message" rows="4" required></textarea>
    </div>
    <button type="submit">Enviar</button>
</form>`
        }
    ],
    css: [
        {
            title: "Reset CSS",
            description: "Reset b√°sico para estilos",
            code: `* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    line-height: 1.6;
    font-family: Arial, sans-serif;
}`
        },
        {
            title: "Flexbox Center",
            description: "Centralizar elementos com Flexbox",
            code: `.container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}`
        }
    ],
    js: [
        {
            title: "Fetch API",
            description: "Exemplo de requisi√ß√£o HTTP com Fetch",
            code: `async function fetchData(url) {
    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error('Erro na requisi√ß√£o');
        }
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Erro:', error);
    }
}`
        },
        {
            title: "Debounce Function",
            description: "Fun√ß√£o debounce para otimiza√ß√£o",
            code: `function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}`
        }
    ],
    python: [
        {
            title: "Hello World",
            description: "Programa Python b√°sico",
            code: `def main():
    print("Hello, World!")
    
if __name__ == "__main__":
    main()`
        },
        {
            title: "Manipula√ß√£o de Arquivos",
            description: "Ler e escrever arquivos",
            code: `# Ler arquivo
with open('arquivo.txt', 'r') as file:
    content = file.read()
    print(content)

# Escrever arquivo
with open('saida.txt', 'w') as file:
    file.write("Texto de exemplo")`
        }
    ]
};
    </script>

    <script>
        
    // ===== CONFIGURA√á√ïES E CONSTANTES =====
    const isFileSystemAccessSupported = 'showDirectoryPicker' in window;

    // üîß SISTEMA DE DEBUG
    const DEBUG_MODE = localStorage.getItem('debugMode') === 'true';
    let debugLogs = [];
    let debugPanel = null;
    
    // ===== DECLARA√á√ÉO DE VARI√ÅVEIS GLOBAIS =====
    let directoryHandle = null;
    let currentFileObj = null;
    let currentFolder = null;
    let folders = {};
    let activeTab = 'html';
    let currentTheme = localStorage.getItem('codeEditorTheme') || 'dark';
    let githubRepo = null;
    let githubToken = null;




    // Vari√°veis dos elementos DOM (ser√£o inicializadas no DOMContentLoaded)
    let htmlEditor, cssEditor, jsEditor, pythonEditor, phpEditor, sqlEditor, jsonEditor, markdownEditor;
    let previewFrame, consoleOutput, previewBtn, closeBtn, previewArea, overlay;
    let codeTabs, saveBtn, hamburgerBtn, closeSidebar, sidebar, editorContainer;
    let newFolderBtn, newFileBtn, requestPermissionBtn, permissionIndicator, permissionText;
    let folderList, fileList, currentFileElement, currentFolderTitle, exportBtn, importBtn;
    let folderModal, fileModal, folderNameInput, fileNameInput;
    let confirmFolderBtn, cancelFolderBtn, confirmFileBtn, cancelFileBtn;
    let importModal, importFileInput, cancelImportBtn, confirmImportBtn;

// ===== SISTEMA DE SNIPPETS =====

function loadSnippets() {
    const snippetsContainer = document.getElementById('snippetsContainer');
    const snippetsList = document.getElementById('snippetsList');
    
    if (!snippetsContainer) return;
    
    // Event listeners para as categorias
    snippetCategories.forEach(button => {
        button.addEventListener('click', function() {
            // Remover classe active de todos os bot√µes
            snippetCategories.forEach(btn => btn.classList.remove('active'));
            // Adicionar classe active ao bot√£o clicado
            this.classList.add('active');
            
            // Carregar snippets da categoria selecionada
            const category = this.getAttribute('data-category');
            displaySnippets(category);
        });
    });
    
    // Carregar primeira categoria por padr√£o
    const firstCategory = snippetCategories[0]?.getAttribute('data-category') || 'html';
    displaySnippets(firstCategory);
}

function displaySnippets(category) {
    const snippetsContainer = document.getElementById('snippetsContainer');
    const snippets = codeSnippets[category] || [];
    
    if (!snippetsContainer) return;
    
    snippetsContainer.innerHTML = '';
    
    if (snippets.length === 0) {
        snippetsContainer.innerHTML = `
            <div class="empty-state">
                Nenhum snippet dispon√≠vel para ${category}
            </div>
        `;
        return;
    }
    
    snippets.forEach((snippet, index) => {
        const snippetElement = document.createElement('div');
        snippetElement.className = 'snippet-item';
        snippetElement.innerHTML = `
            <div class="snippet-header">
                <h4>${snippet.title}</h4>
                <button class="icon-btn insert-snippet" title="Inserir snippet">
                    üì•
                </button>
            </div>
            <div class="snippet-description">
                ${snippet.description}
            </div>
            <pre class="snippet-code"><code>${escapeHtml(snippet.code)}</code></pre>
        `;
        
        // Event listener para inserir snippet
        const insertBtn = snippetElement.querySelector('.insert-snippet');
        insertBtn.addEventListener('click', () => {
            insertSnippet(snippet.code, category);
        });
        
        // Event listener para clicar em todo o snippet
        snippetElement.addEventListener('click', (e) => {
            if (!e.target.classList.contains('insert-snippet') && 
                !e.target.closest('.insert-snippet')) {
                insertSnippet(snippet.code, category);
            }
        });
        
        snippetsContainer.appendChild(snippetElement);
    });
    
    // Aplicar syntax highlighting nos c√≥digos
    Prism.highlightAllUnder(snippetsContainer);
}

function insertSnippet(code, category) {
    // Determinar qual editor est√° ativo
    let targetEditor;
    
    switch(category) {
        case 'html':
            targetEditor = htmlEditor;
            break;
        case 'css':
            targetEditor = cssEditor;
            break;
        case 'js':
            targetEditor = jsEditor;
            break;
        default:
            // Se a categoria n√£o corresponder, usar o editor ativo
            targetEditor = getActiveEditor();
    }
    
    if (!targetEditor) {
        showNotification('Nenhum editor dispon√≠vel para inserir o snippet', 'error');
        return;
    }
    
    // Inserir c√≥digo no editor
    const cursorPosition = targetEditor.selectionStart;
    const currentValue = targetEditor.value;
    
    const newValue = currentValue.substring(0, cursorPosition) + 
                    code + 
                    currentValue.substring(cursorPosition);
    
    targetEditor.value = newValue;
    
    // Atualizar a posi√ß√£o do cursor
    const newCursorPosition = cursorPosition + code.length;
    targetEditor.setSelectionRange(newCursorPosition, newCursorPosition);
    
    // Disparar evento de input para salvar automaticamente
    targetEditor.dispatchEvent(new Event('input'));
    
    // Fechar modal de snippets
    hideSnippetsModal();
    
    showNotification(`Snippet inserido no editor ${category.toUpperCase()}!`, 'success');
}

function escapeHtml(unsafe) {
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

// Fun√ß√µes para mostrar/ocultar modal de snippets
function showSnippetsModal() {
    const snippetsModal = document.getElementById('snippetsModal');
    if (snippetsModal) {
        snippetsModal.classList.add('active');
        overlay.classList.add('active');
        loadSnippets(); // Carregar snippets quando o modal abrir
    }
}

function hideSnippetsModal() {
    const snippetsModal = document.getElementById('snippetsModal');
    if (snippetsModal) {
        snippetsModal.classList.remove('active');
        overlay.classList.remove('active');
    }
}
    // ===== FUN√á√ïES UTILIT√ÅRIAS =====
    
    // Debounce para fun√ß√µes pesadas
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    function getActiveEditor() {
    switch(activeTab) {
        case 'html':
            return htmlEditor;
        case 'css':
            return cssEditor;
        case 'js':
            return jsEditor;
        case 'python':
            return pythonEditor;
        case 'php':
            return phpEditor;
        case 'sql':
            return sqlEditor;
        case 'json':
            return jsonEditor;
        case 'markdown':
            return markdownEditor;
        default:
            return htmlEditor; // fallback
    }
}

// Fun√ß√£o auxiliar para obter editor por tipo
function getEditorByType(type) {
    const editors = {
        'html': htmlEditor,
        'css': cssEditor,
        'js': jsEditor,
        'python': pythonEditor,
        'php': phpEditor,
        'sql': sqlEditor,
        'json': jsonEditor,
        'markdown': markdownEditor
    };
    return editors[type] || null;
}

    // ===== CONFIGURA√á√ïES GITHUB =====
    let isOnline = navigator.onLine;

    // Verificar status de conex√£o
    function updateOnlineStatus() {
        isOnline = navigator.onLine;
        const githubBtn = document.getElementById('githubBtn');
        if (githubBtn) {
            if (!isOnline) {
                githubBtn.style.opacity = '0.5';
                githubBtn.title = 'GitHub (offline)';
            } else {
                githubBtn.style.opacity = '1';
                githubBtn.title = 'GitHub';
            }
        }
    }







    // Configura√ß√µes GitHub
    function showGithubSettings() {
        const githubModal = document.getElementById('githubModal');
        const githubSettings = document.getElementById('githubSettings');
        const githubRepoInput = document.getElementById('githubRepo');
        const githubTokenInput = document.getElementById('githubToken');

        if (githubModal && githubSettings) {
            githubModal.classList.add('active');
            overlay.classList.add('active');

            // Preencher valores salvos
            githubRepoInput.value = githubRepo || '';
            githubTokenInput.value = githubToken || '';

            githubSettings.classList.remove('hidden');
        }
    }

function saveGithubSettings() {
    const githubRepoInput = document.getElementById('githubRepo');
    const githubTokenInput = document.getElementById('githubToken');

    if (!githubRepoInput) return;

    let repoValue = githubRepoInput.value.trim();
    const tokenValue = githubTokenInput.value.trim();

    // ‚úÖ Limpar o formato do reposit√≥rio
    repoValue = repoValue
        .replace('https://github.com/', '')
        .replace('.git', '')
        .trim();

    if (!repoValue) {
        showNotification('O reposit√≥rio do GitHub n√£o pode estar vazio!', 'error');
        return;
    }

    githubRepo = repoValue;
    githubToken = tokenValue;

    localStorage.setItem('githubRepo', githubRepo);
    if (githubToken) {
        localStorage.setItem('githubToken', githubToken);
    } else {
        localStorage.removeItem('githubToken');
    }
    
    showNotification('Configura√ß√µes do GitHub salvas!', 'success');
    hideGithubModal();
}

    function hideGithubModal() {
        const githubModal = document.getElementById('githubModal');
        const githubSettings = document.getElementById('githubSettings');

        if (githubModal && githubSettings) {
            githubModal.classList.remove('active');
            overlay.classList.remove('active');
            if (githubSettings) {
                githubSettings.classList.add('hidden');
            }
            
        }
    }



    // Modificar showNotification para ser acess√≠vel
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        background: ${type === 'error' ? '#da3633' : type === 'success' ? '#388a34' : '#0e639c'};
        color: white;
        border-radius: 4px;
        z-index: 1000;
        font-size: 0.9rem;
        max-width: 300px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    `;
    notification.textContent = message;
    
    // Atributos de acessibilidade
    notification.setAttribute('role', 'alert');
    notification.setAttribute('aria-live', 'polite');
    
    document.body.appendChild(notification);

    // Atualizar live region para leitores de tela
    const liveRegion = document.getElementById('a11y-live-region');
    if (liveRegion) {
        liveRegion.textContent = message;
    }

    setTimeout(() => {
        notification.remove();
    }, 3000);
}

    // ===== DETEC√á√ÉO DE CONEX√ÉO =====

    function setupConnectionMonitoring() {
        window.addEventListener('online', function() {
            isOnline = true;
            updateOnlineStatus();
            showNotification('üåê Conex√£o restaurada - GitHub dispon√≠vel', 'success');
        });

        window.addEventListener('offline', function() {
            isOnline = false;
            updateOnlineStatus();
            showNotification('‚ö†Ô∏è Sem conex√£o - GitHub indispon√≠vel', 'warning');
        });

        // Verificar status inicial
        updateOnlineStatus();
    }

    // Fun√ß√£o para obter √≠cone do arquivo
    function getFileIcon(filename) {
        const extension = filename.split('.').pop().toLowerCase();
        const iconMap = {
            'html': 'üåê',
            'css': 'üé®',
            'js': '‚ö°',
            'py': 'üêç',
            'php': 'üêò',
            'sql': 'üóÉÔ∏è',
            'json': 'üìã',
            'md': 'üìù',
            'txt': 'üìÑ',
            'xml': 'üì∞',
            'yaml': '‚öôÔ∏è',
            'yml': '‚öôÔ∏è'
        };
        return iconMap[extension] || 'üìÑ';
    }

    // Fun√ß√£o para obter tipo do arquivo
    function getFileType(filename) {
        const extension = filename.toLowerCase().split('.').pop();
        const typeMap = {
            'html': 'html',
            'htm': 'html',
            'css': 'css',
            'js': 'js',
            'py': 'python',
            'php': 'php',
            'sql': 'sql',
            'json': 'json',
            'md': 'markdown',
            'txt': 'text',
            'xml': 'xml',
            'yaml': 'yaml',
            'yml': 'yaml'
        };
        return typeMap[extension] || 'text';
    }

    // ===== SISTEMA DE DEBUG =====


    // Fun√ß√£o principal de debug
    function debugLog(message, data = null, type = 'log') {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = {
            timestamp,
            message,
            data,
            type
        };
    
        debugLogs.push(logEntry);
    
        // Sempre log no console
        const consoleMethod = type === 'error' ? console.error : type === 'warn' ? console.warn : console.log;
        consoleMethod(`[${timestamp}] ${message}`, data || '');
    
        // Atualizar painel visual se estiver ativo
        updateDebugPanel();
    
        // Salvar logs no localStorage (√∫ltimos 100)
        if (debugLogs.length > 100) {
            debugLogs = debugLogs.slice(-100);
        }
        localStorage.setItem('debugLogs', JSON.stringify(debugLogs));
    }

    // Fun√ß√£o para medir performance
    function measurePerformance(name, fn) {
        const start = performance.now();
        const result = fn();
        const end = performance.now();
        const duration = (end - start).toFixed(2);
    
        debugLog(`‚è±Ô∏è ${name}`, `${duration}ms`, 'info');
        return result;
    }

    // Criar painel de debug visual
    function createDebugPanel() {
        if (debugPanel) return debugPanel;
    
        debugPanel = document.createElement('div');
        debugPanel.id = 'debugPanel';
        debugPanel.style.cssText = `
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: ${window.innerWidth < 768 ? '95%' : '400px'};
            height: ${window.innerWidth < 768 ? '200px' : '300px'};
            background: rgba(0,0,0,0.95);
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: ${window.innerWidth < 768 ? '10px' : '12px'};
            z-index: 10000;
            border: 2px solid #0f0;
            border-radius: 5px;
            overflow: hidden;
            display: ${DEBUG_MODE ? 'block' : 'none'};
        `;
    
        debugPanel.innerHTML = `
            <div style="padding: 8px; background: #000; border-bottom: 1px solid #0f0; display: flex; justify-content: space-between; align-items: center;">
                <strong>üîß DEBUG PANEL</strong>
                <div>
                    <button id="clearDebug" style="background: #333; color: #0f0; border: 1px solid #0f0; padding: 2px 8px; margin-right: 5px; font-size: ${window.innerWidth < 768 ? '8px' : '10px'};">Clear</button>
                    <button id="closeDebug" style="background: #300; color: #f00; border: 1px solid #f00; padding: 2px 8px; font-size: ${window.innerWidth < 768 ? '8px' : '10px'};">X</button>
                </div>
            </div>
            <div id="debugContent" style="height: calc(100% - 40px); overflow-y: auto; padding: 5px;"></div>
            <div style="padding: 5px; background: #000; border-top: 1px solid #0f0; font-size: ${window.innerWidth < 768 ? '8px' : '10px'};">
                <span id="debugStats">Logs: 0</span>
                | Shift+D to toggle
            </div>
        `;
    
        document.body.appendChild(debugPanel);
    
        // Event listeners do painel
        document.getElementById('clearDebug').addEventListener('click', clearDebugLogs);
        document.getElementById('closeDebug').addEventListener('click', toggleDebugPanel);
    
        return debugPanel;
    }

    // Atualizar conte√∫do do painel
    function updateDebugPanel() {
        if (!debugPanel || !DEBUG_MODE) return;
    
        const debugContent = document.getElementById('debugContent');
        const debugStats = document.getElementById('debugStats');
    
        if (!debugContent) return;
    
        let html = '';
        debugLogs.slice(-50).forEach(log => {
            const color = log.type === 'error' ? '#f00' : log.type === 'warn' ? '#ff0' : '#0f0';
            html += `
                <div style="margin-bottom: 2px; border-left: 2px solid ${color}; padding-left: 5px;">
                    <span style="color: #888;">[${log.timestamp}]</span>
                    <span style="color: ${color}; margin-left: 5px;">${log.message}</span>
                    ${log.data ? `<div style="color: #aaa; margin-left: 10px; font-size: ${window.innerWidth < 768 ? '9px' : '11px'};">${JSON.stringify(log.data)}</div>` : ''}
                </div>
            `;
        });
    
        debugContent.innerHTML = html;
        debugContent.scrollTop = debugContent.scrollHeight;
        debugStats.textContent = `Logs: ${debugLogs.length}`;
    }

    // Limpar logs
    function clearDebugLogs() {
        debugLogs = [];
        localStorage.removeItem('debugLogs');
        updateDebugPanel();
        debugLog('üßπ Logs de debug limpos');
    }

    // Alternar visibilidade do painel
    function toggleDebugPanel() {
        if (!debugPanel) createDebugPanel();
    
        const isVisible = debugPanel.style.display !== 'none';
        debugPanel.style.display = isVisible ? 'none' : 'block';
    
        if (!isVisible) {
            updateDebugPanel();
        }
    
        debugLog(`üîß Painel de debug ${isVisible ? 'oculto' : 'vis√≠vel'}`);
    }

    // Carregar logs salvos
    function loadDebugLogs() {
        try {
            const savedLogs = localStorage.getItem('debugLogs');
            if (savedLogs) {
                debugLogs = JSON.parse(savedLogs);
            }
        } catch (e) {
            console.error('Erro ao carregar logs:', e);
        }
    }

    // Configurar atalhos de teclado para debug
    function setupDebugShortcuts() {
        document.addEventListener('keydown', (e) => {
            // Shift + D - Alternar debug
            if (e.shiftKey && e.key === 'D') {
                e.preventDefault();
                const currentMode = localStorage.getItem('debugMode') === 'true';
                localStorage.setItem('debugMode', !currentMode);
                debugLog(`üîß Modo debug ${!currentMode ? 'ativado' : 'desativado'}`);
                showNotification(`Debug mode ${!currentMode ? 'ativado' : 'desativado'}`);
            
                if (!currentMode) {
                    createDebugPanel();
                } else if (debugPanel) {
                    debugPanel.style.display = 'none';
                }
            }
        
            // Shift + L - Mostrar/ocultar logs
            if (e.shiftKey && e.key === 'L') {
                e.preventDefault();
                toggleDebugPanel();
            }
        
            // Shift + C - Limpar logs
            if (e.shiftKey && e.key === 'C') {
                e.preventDefault();
                clearDebugLogs();
            }
        });
    }

    // Fun√ß√£o para debug de estado da aplica√ß√£o
    function debugAppState() {
        const state = {
            theme: currentTheme,
            activeTab,
            currentFolder,
            currentFile: currentFileObj ? {
                name: currentFileObj.name,
                folder: currentFileObj.folder
            } : null,
            folders: Object.keys(folders),
            fileCount: Object.keys(folders).reduce((acc, folder) => 
                acc + Object.keys(folders[folder].files || {}).length, 0),
            permission: !!directoryHandle,
            localStorageUsage: JSON.stringify(localStorage).length,
            debugMode: DEBUG_MODE
        };
    
        debugLog('üìä Estado da Aplica√ß√£o', state, 'info');
        return state;
    }
    
async function requestFileSystemPermission() {
    // Prevenir m√∫ltiplos cliques
    if (requestPermissionBtn.disabled) return;
    
    requestPermissionBtn.disabled = true;
    requestPermissionBtn.textContent = 'Solicitando...';
    
    if (!isFileSystemAccessSupported) {
        if (/Android|iPhone|iPad/.test(navigator.userAgent)) {
            const result = await mobileFileAccess();
            requestPermissionBtn.disabled = false;
            requestPermissionBtn.textContent = 'Solicitar Permiss√£o';
            return result;
        }
        alert('Seu navegador n√£o suporta acesso ao sistema de arquivos. Use Chrome ou Edge.');
        requestPermissionBtn.disabled = false;
        requestPermissionBtn.textContent = 'Solicitar Permiss√£o';
        return;
    }
    
    try {
        directoryHandle = await window.showDirectoryPicker();
        updatePermissionStatus();
        await scanDirectory();
        showNotification('‚úÖ Pasta selecionada! Agora voc√™ pode gerenciar arquivos em: ' + directoryHandle.name, 'success');
    } catch (error) {
        console.error('Erro ao solicitar permiss√£o:', error);
        if (error.name !== 'AbortError') {
            showNotification('Erro ao acessar o sistema de arquivos.', 'error');
        }
    } finally {
        // Sempre reativar o bot√£o
        requestPermissionBtn.disabled = false;
        requestPermissionBtn.textContent = 'Solicitar Permiss√£o';
    }
}

    async function mobileFileAccess() {
        return new Promise((resolve) => {
            if (confirm('No mobile, voc√™ pode:\n\n1. Trabalhar localmente (recomendado)\n2. Tentar importar arquivos\n\nDeseja importar arquivos?')) {
                const input = document.createElement('input');
                input.type = 'file';
                input.multiple = true;
                input.accept = '.html,.css,.js,.txt,.json,.py,.php,.sql,.md';
                input.onchange = (e) => {
                    resolve(Array.from(e.target.files));
                };
                input.click();
            } else {
                resolve(null);
            }
        });
    }

    async function scanDirectory() {
        if (!directoryHandle) return;
        
        folders = {};
        
        try {
            folderList.innerHTML = '<div class="empty-state">üìÅ Carregando pasta...</div>';

            for await (const entry of directoryHandle.values()) {
                if (entry.kind === 'directory') {
                    const folderName = entry.name;
                    folders[folderName] = {
                        handle: entry,
                        files: {}
                    };

                    try {
                        for await (const fileEntry of entry.values()) {
                            if (fileEntry.kind === 'file') {
                                await processFileEntry(entry, fileEntry, folderName);
                            }
                        }
                    } catch (folderError) {
                        console.warn(`Erro ao ler pasta ${folderName}:`, folderError);
                    }
                } else if (entry.kind === 'file') {
                    await processFileEntry(directoryHandle, entry, 'root');
                }
            }

            if (Object.keys(folders).length === 0) {
                await createDefaultFolder();
            }

            saveToLocalStorage();
            loadFolders();

        } catch(error) {
            console.error('Erro ao escanear diret√≥rio:', error);
            folderList.innerHTML = '<div class="empty-state">‚ùå Erro ao carregar pastas</div>';
        }      
    }

    async function processFileEntry(parentHandle, fileEntry, folderName) {
        const fileName = fileEntry.name;

        if (fileName.match(/\.(html|css|js|py|php|sql|json|md|txt|xml|yaml|yml)$/i)) {
            try {
                const fileHandle = await parentHandle.getFileHandle(fileName);
                const file = await fileHandle.getFile();
                const content = await file.text();

                const baseName = fileName.replace(/\.[^/.]+$/, "");
                const fileType = getFileType(fileName);

                if (!folders[folderName]){
                    folders[folderName] = {
                        handle: parentHandle,
                        files: {}
                    };
                }

                if (!folders[folderName].files[baseName]) {
                    folders[folderName].files[baseName] = {};
                }

                folders[folderName].files[baseName][fileType] = content;
                folders[folderName].files[baseName].handle = folders[folderName].files[baseName].handle || {};
                folders[folderName].files[baseName].handle[fileType] = fileHandle;

            } catch(fileError) {
                console.warn(`Erro ao processar arquivo ${fileName}:`, fileError);
            }
        }
    }

    function updatePermissionStatus() {
        const hasPermission = directoryHandle !== null;
        permissionIndicator.className = `status-indicator ${hasPermission ? 'granted' : ''}`;
        permissionText.textContent = hasPermission ? 'Concedida' : 'N√£o concedida';
        requestPermissionBtn.style.display = hasPermission ? 'none' : 'block';
    }

    // ===== GERENCIAMENTO DE PASTAS E ARQUIVOS =====
    
    function loadFromLocalStorage() {
        const savedData = localStorage.getItem('codeEditorData');
        if (savedData) {
            const data = JSON.parse(savedData);
            folders = data.folders || {};
            loadFolders();
        }
    }
    
    function saveToLocalStorage() {
        const data = {
            folders: folders
        };
        localStorage.setItem('codeEditorData', JSON.stringify(data));
    }
    
    function loadFolders() {
        folderList.innerHTML = '';
        
        if (Object.keys(folders).length === 0) {
            folderList.innerHTML = '<div class="empty-state">Nenhuma pasta encontrada</div>';
            fileList.innerHTML = '<div class="empty-state">Selecione uma pasta</div>';
            return;
        }
        
        for (const folderName in folders) {
            const folder = folders[folderName];
            const folderElement = document.createElement('div');
            folderElement.className = 'folder-item';
            if (currentFolder === folderName) {
                folderElement.classList.add('active');
            }
            
            folderElement.innerHTML = `
                <div>
                    <span class="folder-icon">üìÅ</span>
                    ${folderName}
                </div>
                <div class="folder-actions">
                    <button class="icon-btn delete-folder" title="Excluir pasta">üóëÔ∏è</button>
                </div>
            `;
            
            folderElement.addEventListener('click', (e) => {
                if (!e.target.classList.contains('delete-folder') && 
                    !e.target.parentElement.classList.contains('delete-folder')) {
                    selectFolder(folderName);
                }
            });
            
            const deleteBtn = folderElement.querySelector('.delete-folder');
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                deleteFolder(folderName);
            });
            
            folderList.appendChild(folderElement);
        }
        
        if (currentFolder) {
            loadFiles(currentFolder);
        }
    }
    
    function loadFiles(folderName) {
        fileList.innerHTML = '';
        const folder = folders[folderName];
        
        if (!folder || Object.keys(folder.files).length === 0) {
            fileList.innerHTML = '<div class="empty-state">Nenhum arquivo na pasta</div>';
            return;
        }
        
        currentFolderTitle.textContent = `Arquivos - ${folderName}`;
        
        for (const fileName in folder.files) {
            const file = folder.files[fileName];
            const fileElement = document.createElement('div');
            fileElement.className = 'file-item';
            if (currentFileObj && currentFileObj.name === fileName) {
                fileElement.classList.add('active');
            }
            
            fileElement.innerHTML = `
                <div>${getFileIcon(fileName)} ${fileName}</div>
                <div class="file-actions">
                    <button class="icon-btn delete-file" title="Excluir arquivo">üóëÔ∏è</button>
                </div>
            `;
            
            fileElement.addEventListener('click', (e) => {
                if (!e.target.classList.contains('delete-file') && 
                    !e.target.parentElement.classList.contains('delete-file')) {
                    selectFile(folderName, fileName);
                }
            });
            
            const deleteBtn = fileElement.querySelector('.delete-file');
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                deleteFile(folderName, fileName);
            });
            
            fileList.appendChild(fileElement);
        }
    }
    
    function selectFolder(folderName) {
        currentFolder = folderName;
        currentFileObj = null;
        clearEditors();
        loadFolders();
        loadFiles(folderName);
        currentFileElement.textContent = `Pasta: ${folderName}`;
    }
    
    function selectFile(folderName, fileName) {
        const folder = folders[folderName];
        if (!folder || !folder.files[fileName]) return;
        
        currentFileObj = {
            name: fileName,
            folder: folderName,
            ...folder.files[fileName]
        };
        
        // Carregar conte√∫do nos editores
        htmlEditor.value = currentFileObj.html || '';
        cssEditor.value = currentFileObj.css || '';
        jsEditor.value = currentFileObj.js || '';
        pythonEditor.value = currentFileObj.py || currentFileObj.python || '';
        phpEditor.value = currentFileObj.php || '';
        sqlEditor.value = currentFileObj.sql || '';
        jsonEditor.value = currentFileObj.json || '';
        markdownEditor.value = currentFileObj.md || currentFileObj.markdown || '';
        
        // Atualizar UI
        loadFiles(folderName);
        currentFileElement.textContent = `Editando: ${fileName} (${folderName})`;
        
        // Fechar sidebar em dispositivos m√≥veis
        if (window.innerWidth < 768) {
            toggleSidebar();
        }
    }
    
    function clearEditors() {
        if (htmlEditor) htmlEditor.textContent = '';
        if (cssEditor) cssEditor.textContent = '';
        if (jsEditor) jsEditor.textContent = '';
        if (pythonEditor) pythonEditor.textContent = '';
        if (phpEditor) phpEditor.textContent = '';
        if (sqlEditor) sqlEditor.textContent = '';
        if (jsonEditor) jsonEditor.textContent = '';
        if (markdownEditor) markdownEditor.textContent = '';

        // Atualizar syntax highlighting
        updateSyntaxHighlighting();

        if (currentFileElement) {
            currentFileElement.textContent = 'Nenhum arquivo selecionado';
        }
        
    }

    // ===== OPERA√á√ïES DE ARQUIVOS =====
    
    async function createDefaultFolder() {
        try {
            const defaultFolderHandle = await directoryHandle.getDirectoryHandle('meus-projetos', {create: true});
            folders['meus-projetos'] = {
                handle: defaultFolderHandle,
                files: {}
            };
        } catch (error) {
            console.error('Erro ao criar pasta padr√£o', error);
        }
    }

    async function createFolder() {
        const folderName = folderNameInput.value.trim();

        if (!folderName) {
            showNotification('Digite um nome para a pasta!', 'error');
            return;
        }

        if (folders[folderName]) {
            showNotification('J√° existe uma pasta com este nome!', 'error');
            return;
        }

        try {
            const newFolderHandle = await directoryHandle.getDirectoryHandle(folderName, { create: true });

            folders[folderName] = {
                handle: newFolderHandle,
                files: {}
            };

            saveToLocalStorage();
            hideFolderModal();
            loadFolders();
            showNotification(`üìÅ Pasta "${folderName}" criada!`, 'success');
        } catch (error) {
            console.error('Erro ao criar pasta:', error);
            showNotification('‚ùå Erro ao criar pasta', 'error');
        }
    }
    
async function createFile() {
    const fileName = fileNameInput.value.trim();
    
    if (!fileName) {
        showNotification('Digite um nome para o arquivo!', 'error');
        return;
    }
    
    if (!currentFolder) {
        showNotification('Selecione uma pasta primeiro!', 'error');
        return;
    }
    
    if (folders[currentFolder].files[fileName]) {
        showNotification('J√° existe um arquivo com este nome!', 'error');
        return;
    }
    
    try {
        // Criar apenas a estrutura na mem√≥ria
        folders[currentFolder].files[fileName] = {
            html: '',
            css: '',
            js: '',
            python: '',
            php: '',
            sql: '',
            json: '',
            markdown: ''
        };
        
        // Salvar no localStorage
        saveToLocalStorage();
        
        hideFileModal();
        loadFiles(currentFolder);
        selectFile(currentFolder, fileName);
        showNotification(`üìÑ Arquivo "${fileName}" criado com sucesso!`, 'success');
    } catch (error) {
        console.error('Erro ao criar arquivo:', error);
        showNotification('‚ùå Erro ao criar arquivo', 'error');
    }
}
    
    async function writeFile(fileHandle, content) {
        const writable = await fileHandle.createWritable();
        await writable.write(content);
        await writable.close();
    }

    async function saveFileToDisk(folderName, fileName, extension, content) {
        const folderHandle = folders[folderName].handle;
        const fileHandle = await folderHandle.getFileHandle(`${fileName}.${extension}`, { create: true });
        const writable = await fileHandle.createWritable();
        await writable.write(content);
        await writable.close();
    }

    async function saveCurrentFile() {
        if (!currentFileObj) {
            showNotification('Selecione um arquivo primeiro!', 'error');
            return;
        }

        const folderName = currentFileObj.folder;
        const fileName = currentFileObj.name;

        if (!folders[folderName] || !folders[folderName].files[fileName]) {
            showNotification('Arquivo n√£o encontrado!', 'error');
            return;
        }

        try {
            // Atualizar conte√∫do na mem√≥ria para todas as linguagens
            folders[folderName].files[fileName].html = htmlEditor.value;
            folders[folderName].files[fileName].css = cssEditor.value;
            folders[folderName].files[fileName].js = jsEditor.value;
            folders[folderName].files[fileName].python = pythonEditor.value;
            folders[folderName].files[fileName].php = phpEditor.value;
            folders[folderName].files[fileName].sql = sqlEditor.value;
            folders[folderName].files[fileName].json = jsonEditor.value;
            folders[folderName].files[fileName].markdown = markdownEditor.value;

            // Salvar no localStorage
            saveToLocalStorage();

            // Salvar no sistema de arquivos se tiver permiss√£o
            if (directoryHandle && folders[folderName].handle) {
                const saveOperations = [];
                
                if (htmlEditor.value.trim()) saveOperations.push(saveFileToDisk(folderName, fileName, 'html', htmlEditor.value));
                if (cssEditor.value.trim()) saveOperations.push(saveFileToDisk(folderName, fileName, 'css', cssEditor.value));
                if (jsEditor.value.trim()) saveOperations.push(saveFileToDisk(folderName, fileName, 'js', jsEditor.value));
                if (pythonEditor.value.trim()) saveOperations.push(saveFileToDisk(folderName, fileName, 'py', pythonEditor.value));
                if (phpEditor.value.trim()) saveOperations.push(saveFileToDisk(folderName, fileName, 'php', phpEditor.value));
                if (sqlEditor.value.trim()) saveOperations.push(saveFileToDisk(folderName, fileName, 'sql', sqlEditor.value));
                if (jsonEditor.value.trim()) saveOperations.push(saveFileToDisk(folderName, fileName, 'json', jsonEditor.value));
                if (markdownEditor.value.trim()) saveOperations.push(saveFileToDisk(folderName, fileName, 'md', markdownEditor.value));
                
                await Promise.all(saveOperations);
                showNotification('‚úÖ Arquivo salvo com sucesso!', 'success');
            } else {
                showNotification('üíæ Arquivo salvo localmente!', 'success');
            }
        } catch (error) {
            console.error('Erro ao salvar:', error);
            showNotification('‚ùå Erro ao salvar arquivo', 'error');
        }
    }
    async function exportAllFiles() {
    if (!directoryHandle) {
        showNotification('Solicite permiss√£o de armazenamento primeiro!', 'error');
        return;
    }

    try {
        showNotification('üì§ Exportando todos os arquivos...', 'info');
    
        // Exportar cada pasta e arquivo
        for (const folderName in folders) {
            const folder = folders[folderName];
        
            for (const fileName in folder.files) {
                const file = folder.files[fileName];
                
                // Salvar cada tipo de arquivo
                if (file.html) {
                    await saveFileToDisk(folderName, fileName, 'html', file.html);
                }
                if (file.css) {
                    await saveFileToDisk(folderName, fileName, 'css', file.css);
                }
                if (file.js) {
                    await saveFileToDisk(folderName, fileName, 'js', file.js);
                }
                if (file.python) {
                    await saveFileToDisk(folderName, fileName, 'py', file.python);
                }
                if (file.php) {
                    await saveFileToDisk(folderName, fileName, 'php', file.php);
                }
                if (file.sql) {
                    await saveFileToDisk(folderName, fileName, 'sql', file.sql);
                }
                if (file.json) {
                    await saveFileToDisk(folderName, fileName, 'json', file.json);
                }
                if (file.markdown) {
                    await saveFileToDisk(folderName, fileName, 'md', file.markdown);
                }
            }
        }
    
        showNotification('‚úÖ Todos os arquivos exportados com sucesso!', 'success');
    } catch (error) {
        console.error('Erro ao exportar arquivos:', error);
        showNotification('‚ùå Erro ao exportar arquivos', 'error');
    }
}

// ===== FUN√á√ïES DE IMPORTA√á√ÉO =====

async function importFiles() {
    if (!directoryHandle) {
        showNotification('Solicite permiss√£o de armazenamento primeiro!', 'error');
        return;
    }
    
    // Usar o input file diretamente em vez do modal para simplificar
    const input = document.createElement('input');
    input.type = 'file';
    input.multiple = true;
    input.accept = '.html,.css,.js,.txt,.json,.py,.php,.sql,.md';
    
    input.onchange = async (e) => {
        const files = Array.from(e.target.files);
        if (files.length === 0) return;
        
        showNotification(`üì• Importando ${files.length} arquivo(s)...`, 'info');
        
        try {
            for (const file of files) {
                await processImportedFile(file);
            }
            
            saveToLocalStorage();
            loadFolders();
            showNotification('‚úÖ Arquivos importados com sucesso!', 'success');
        } catch (error) {
            console.error('Erro ao importar arquivos:', error);
            showNotification('‚ùå Erro ao importar arquivos', 'error');
        }
    };
    
    input.click();
}

async function processImportedFile(file) {
    const content = await file.text();
    const fileName = file.name.replace(/\.[^/.]+$/, "");
    const fileType = getFileType(file.name);
    
    if (!fileType) return;
    
    // Usar pasta atual ou criar uma padr√£o
    const targetFolder = currentFolder || 'importados';
    
    if (!folders[targetFolder]) {
        folders[targetFolder] = {
            handle: null,
            files: {}
        };
    }
    
    if (!folders[targetFolder].files[fileName]) {
        folders[targetFolder].files[fileName] = {};
    }
    
    folders[targetFolder].files[fileName][fileType] = content;
}

// Fun√ß√µes para mostrar/ocultar modais de importa√ß√£o
function showImportModal() {
    importModal.classList.add('active');
    overlay.classList.add('active');
    importFileInput.value = '';
}

function hideImportModal() {
    importModal.classList.remove('active');
    overlay.classList.remove('active');
}

async function handleImportConfirm() {
    const files = importFileInput.files;
    if (files.length === 0) {
        showNotification('Selecione arquivos para importar!', 'error');
        return;
    }
    
    hideImportModal();
    
    showNotification(`üì• Importando ${files.length} arquivo(s)...`, 'info');
    
    try {
        for (const file of files) {
            await processImportedFile(file);
        }
        
        saveToLocalStorage();
        loadFolders();
        showNotification('‚úÖ Arquivos importados com sucesso!', 'success');
    } catch (error) {
        console.error('Erro ao importar arquivos:', error);
        showNotification('‚ùå Erro ao importar arquivos', 'error');
    }
}

    async function deleteFolder(folderName) {
        if (!confirm(`Tem certeza que deseja excluir a pasta "${folderName}" e todos os seus arquivos?`)) {
            return;
        }
        
        try {
            if (directoryHandle) {
                await directoryHandle.removeEntry(folderName, { recursive: true });
            }
            
            delete folders[folderName];
            
            if (currentFolder === folderName) {
                currentFolder = null;
                currentFileObj = null;
                clearEditors();
            }
            
            saveToLocalStorage();
            loadFolders();
            showNotification(`üóëÔ∏è Pasta "${folderName}" exclu√≠da!`, 'success');
        } catch (error) {
            console.error('Erro ao excluir pasta:', error);
            showNotification('‚ùå Erro ao excluir pasta', 'error');
        }
    }
    
    async function deleteFile(folderName, fileName) {
        if (!confirm(`Tem certeza que deseja excluir o arquivo "${fileName}"?`)) {
            return;
        }
        
        try {
            const folderHandle = folders[folderName].handle;
            
            // Excluir arquivos do sistema de arquivos
            const extensions = ['html', 'css', 'js', 'py', 'php', 'sql', 'json', 'md'];
            for (const ext of extensions) {
                try {
                    await folderHandle.removeEntry(`${fileName}.${ext}`);
                } catch (e) {
                    // Arquivo pode n√£o existir, continua
                }
            }
            
            delete folders[folderName].files[fileName];
            
            if (currentFileObj && currentFileObj.name === fileName) {
                currentFileObj = null;
                clearEditors();
            }
            
            saveToLocalStorage();
            loadFiles(folderName);
            showNotification(`üóëÔ∏è Arquivo "${fileName}" exclu√≠do!`, 'success');
        } catch (error) {
            console.error('Erro ao excluir arquivo:', error);
            showNotification('‚ùå Erro ao excluir arquivo', 'error');
        }
    }

    // ===== SISTEMA DE PREVIEW =====
    
    function showPreview() {
        if (!currentFileObj) {
            showNotification('Selecione um arquivo primeiro!', 'error');
            return;
        }
        
        updatePreview();
        previewArea.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function hidePreview() {
        previewArea.classList.remove('active');
        document.body.style.overflow = 'auto';
    }
    
    function updatePreview() {
        // Limpar console
        consoleOutput.innerHTML = '';
        
        // Obter c√≥digo dos editores
        const htmlCode = htmlEditor.value;
        const cssCode = cssEditor.value;
        const jsCode = jsEditor.value;
        
        // Criar documento completo
        const fullHtml = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <style>${cssCode}</style>
            </head>
            <body>
                ${htmlCode}
                <script>
                    // Substituir console para capturar logs
                    const originalConsole = {
                        log: console.log,
                        error: console.error,
                        warn: console.warn
                    };
                    
                    // Fun√ß√£o para enviar logs para o editor
                    function sendToConsole(type, ...args) {
                        const message = args.map(arg => 
                            typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
                        ).join(' ');
                        
                        window.parent.postMessage({
                            type: 'console',
                            level: type,
                            message: message,
                            timestamp: new Date().toLocaleTimeString()
                        }, '*');
                        
                        // Manter a funcionalidade original do console
                        originalConsole[type](...args);
                    }
                    
                    // Substituir m√©todos do console
                    console.log = (...args) => sendToConsole('log', ...args);
                    console.error = (...args) => sendToConsole('error', ...args);
                    console.warn = (...args) => sendToConsole('warn', ...args);
                    
                    // Capturar erros globais
                    window.addEventListener('error', (event) => {
                        sendToConsole('error', event.error ? event.error.toString() : event.message);
                        return false;
                    });
                    
                    // Capturar promessas rejeitadas n√£o tratadas
                    window.addEventListener('unhandledrejection', (event) => {
                        sendToConsole('error', 'Promessa rejeitada: ' + (event.reason || 'Unknown error'));
                    });
                <\/script>
                <script>${jsCode}<\/script>
            </body>
            </html>
        `;
        
        // Atualizar iframe
        previewFrame.srcdoc = fullHtml;
        
        // Adicionar mensagem inicial ao console
        const initialLog = document.createElement('div');
        initialLog.className = 'console-log';
        initialLog.textContent = `> [${new Date().toLocaleTimeString()}] Preview carregado.`;
        consoleOutput.appendChild(initialLog);
    }
    
    function handleConsoleMessage(event) {
        if (event.data.type === 'console') {
            const logElement = document.createElement('div');
            logElement.className = `console-${event.data.level}`;
            logElement.textContent = `> [${event.data.timestamp || new Date().toLocaleTimeString()}] ${event.data.message}`;
            consoleOutput.appendChild(logElement);
            
            // Rolagem autom√°tica para o final
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
    }


    // ===== LAZY LOADING OPTIMIZATIONS =====

let editorsLoaded = {
    html: false,
    css: false,
    js: false,
    python: false,
    php: false,
    sql: false,
    json: false,
    markdown: false
};

function initializeLazyLoading() {
    // Observar quando as abas se tornam vis√≠veis
    const tabObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const tabName = entry.target.getAttribute('data-tab');
                loadEditorIfNeeded(tabName);
            }
        });
    }, { threshold: 0.1 });

    // Observar todas as abas
    codeTabs.forEach(tab => {
        tabObserver.observe(tab);
    });

    // Carregar editor ativo inicialmente
    loadEditorIfNeeded(activeTab);
}

function loadEditorIfNeeded(tabName) {
    if (editorsLoaded[tabName]) return;

    const editor = getEditorByType(tabName);
    if (editor) {
        // Simular carregamento ass√≠ncrono (em produ√ß√£o, carregaria syntax highlighting)
        setTimeout(() => {
            editor.classList.remove('loading');
            editorsLoaded[tabName] = true;
            debugLog(`Editor ${tabName} carregado via lazy loading`);
        }, 100);
    }
}

// Modificar a fun√ß√£o switchTab para suportar lazy loading
function switchTab(tabName) {
    activeTab = tabName;
    
    // Atualizar abas
    codeTabs.forEach(tab => {
        tab.classList.remove('active');
        if (tab.getAttribute('data-tab') === tabName) {
            tab.classList.add('active');
        }
    });
    
    // Mostrar editor correspondente com lazy loading
    document.querySelectorAll('.code-editor').forEach(editor => {
        editor.classList.add('hidden');
    });
    
    const activeEditor = document.getElementById(tabName + 'Editor');
    if (activeEditor) {
        activeEditor.classList.remove('hidden');
        loadEditorIfNeeded(tabName);
        
        // Foco autom√°tico no editor ativo (apenas em desktop)
        if (window.innerWidth > 768) {
            setTimeout(() => activeEditor.focus(), 100);
        }
    }
}

// Adicionar CSS para estado de loading
const lazyLoadingStyles = `
.code-editor.loading {
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
}

@keyframes loading {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

.editor-placeholder {
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #666;
    font-style: italic;
}
`;

// Injetar styles
const styleSheet = document.createElement('style');
styleSheet.textContent = lazyLoadingStyles;
document.head.appendChild(styleSheet);

    

function toggleSidebar() {
    const isOpening = !sidebar.classList.contains('active');
    sidebar.classList.toggle('active');
    editorContainer.classList.toggle('sidebar-open');
    overlay.classList.toggle('active');

    // ATUALIZAR: Corrigir atributos ARIA
    sidebar.setAttribute('aria-hidden', (!isOpening).toString());
    hamburgerBtn.setAttribute('aria-expanded', isOpening.toString());
    hamburgerBtn.setAttribute('aria-label', isOpening ? 'Fechar menu lateral' : 'Abrir menu lateral');

    // Em mobile, impedir rolagem do body quando sidebar aberta
    if (window.innerWidth < 768) {
        document.body.style.overflow = isOpening ? 'hidden' : 'auto';
    }

    // ATUALIZAR: Gerenciar foco corretamente
    if (isOpening) {
        setTimeout(() => {
            const firstInteractive = sidebar.querySelector('button, input, [tabindex]');
            if (firstInteractive) {
                firstInteractive.focus();
                // Remover aria-hidden do elemento com foco
                firstInteractive.removeAttribute('aria-hidden');
            }
        }, 100);
    } else {
        // Devolver foco para o bot√£o hamburger quando fechar
        hamburgerBtn.focus();
    }
}

    function closeAllModals() {
        sidebar.classList.remove('active');
        editorContainer.classList.remove('sidebar-open');
        overlay.classList.remove('active');
        folderModal.classList.remove('active');
        fileModal.classList.remove('active');
        previewArea.classList.remove('active');
    }

    // Modais de pasta
    function showNewFolderModal() {
        if (!directoryHandle) {
            showNotification('Solicite permiss√£o de armazenamento primeiro!', 'error');
            return;
        }
        
        folderModal.classList.add('active');
        overlay.classList.add('active');
        folderNameInput.value = '';
        folderNameInput.focus();
    }
    
    function hideFolderModal() {
        folderModal.classList.remove('active');
        overlay.classList.remove('active');
    }
    
    // Modais de arquivo
    function showNewFileModal() {
        if (!currentFolder) {
            showNotification('Selecione uma pasta primeiro!', 'error');
            return;
        }
        
        fileModal.classList.add('active');
        overlay.classList.add('active');
        fileNameInput.value = '';
        fileNameInput.focus();
    }
    
    function hideFileModal() {
        fileModal.classList.remove('active');
        overlay.classList.remove('active');
    }

    // ===== INTERFACE E CONTROLES =====
    
    function switchTab(tabName) {
        activeTab = tabName;
        
        // Atualizar abas
        codeTabs.forEach(tab => {
            tab.classList.remove('active');
            if (tab.getAttribute('data-tab') === tabName) {
                tab.classList.add('active');
            }
        });
        
        // Mostrar editor correspondente
        document.querySelectorAll('.code-editor').forEach(editor => {
            editor.classList.add('hidden');
        });
        
        const activeEditor = document.getElementById(tabName + 'Editor');
        if (activeEditor) {
            activeEditor.classList.remove('hidden');
            
            // Foco autom√°tico no editor ativo (apenas em desktop)
            if (window.innerWidth > 768) {
                setTimeout(() => activeEditor.focus(), 100);
            }
        }
    }

    // ===== OTIMIZA√á√ïES MOBILE =====
    
    function setupMobileOptimizations() {
        // Prevenir zoom duplo-toque em elementos interativos
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });

        // Melhorar rolagem em iOS
        document.addEventListener('touchmove', function(e) {
            if (e.scale !== 1) {
                e.preventDefault();
            }
        }, { passive: false });

        // Detectar orienta√ß√£o da tela
        window.addEventListener('orientationchange', function() {
            setTimeout(adjustLayoutForOrientation, 100);
        });

        function adjustLayoutForOrientation() {
            if (window.innerHeight > window.innerWidth) {
                document.body.classList.add('portrait');
                document.body.classList.remove('landscape');
            } else {
                document.body.classList.add('landscape');
                document.body.classList.remove('portrait');
            }
        }

        adjustLayoutForOrientation();
    }

    function setupSidebarGestures() {
        let startX = 0;
        let currentX = 0;
        let isDragging = false;

        sidebar.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            isDragging = true;
        });

        sidebar.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            currentX = e.touches[0].clientX;
            const diff = startX - currentX;

            // Se arrastando para a esquerda, fechar sidebar
            if (diff > 50 && sidebar.classList.contains('active')) {
                toggleSidebar();
                isDragging = false;
            }
        });

        sidebar.addEventListener('touchend', () => {
            isDragging = false;
        });
    }

    function optimizedUpdatePreview() {
        if (previewFrame.contentWindow && previewFrame.contentWindow.stop) {
            previewFrame.contentWindow.stop();
        }

        requestAnimationFrame(() => {
            updatePreview();
        });
    }


    // ===== MELHORIAS DE ACESSIBILIDADE =====

function setupAccessibility() {
    // Adicionar ARIA labels aos elementos cr√≠ticos
    const ariaLabels = {
        'hamburgerBtn': 'Abrir menu lateral',
        'closeSidebar': 'Fechar menu lateral',
        'previewBtn': 'Abrir visualiza√ß√£o do c√≥digo',
        'saveBtn': 'Salvar arquivo atual',
        'newFolderBtn': 'Criar nova pasta',
        'newFileBtn': 'Criar novo arquivo',
        'themeBtn': 'Alternar entre tema claro e escuro',
        'githubBtn': 'Configura√ß√µes do GitHub',
        'snippetsBtn': 'Abrir biblioteca de snippets de c√≥digo'
    };

    // Aplicar labels
    Object.keys(ariaLabels).forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.setAttribute('aria-label', ariaLabels[id]);
        }
    });

    // Configurar roles sem√¢nticas
    document.getElementById('sidebar')?.setAttribute('role', 'navigation');
    document.getElementById('editorContainer')?.setAttribute('role', 'main');
    document.querySelectorAll('.code-tab').forEach(tab => {
        tab.setAttribute('role', 'tab');
        tab.setAttribute('aria-selected', 'false');
    });

    // Atualizar aria-selected nas abas
    updateTabAccessibility();

    // Configurar live regions para notifica√ß√µes
    const liveRegion = document.createElement('div');
    liveRegion.id = 'a11y-live-region';
    liveRegion.setAttribute('aria-live', 'polite');
    liveRegion.setAttribute('aria-atomic', 'true');
    liveRegion.style.cssText = 'position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;';
    document.body.appendChild(liveRegion);
}

function updateTabAccessibility() {
    document.querySelectorAll('.code-tab').forEach(tab => {
        const isActive = tab.getAttribute('data-tab') === activeTab;
        tab.setAttribute('aria-selected', isActive.toString());
        tab.setAttribute('tabindex', isActive ? '0' : '-1');
    });
}

// Adicionar suporte a navega√ß√£o por teclado
function setupKeyboardNavigation() {
    document.addEventListener('keydown', (e) => {
        // Navega√ß√£o entre abas com Ctrl+PageUp/PageDown
        if (e.ctrlKey && (e.key === 'PageUp' || e.key === 'PageDown')) {
            e.preventDefault();
            const tabs = Array.from(codeTabs);
            const currentIndex = tabs.findIndex(tab => tab.getAttribute('data-tab') === activeTab);
            let newIndex;
            
            if (e.key === 'PageUp') {
                newIndex = currentIndex > 0 ? currentIndex - 1 : tabs.length - 1;
            } else {
                newIndex = currentIndex < tabs.length - 1 ? currentIndex + 1 : 0;
            }
            
            switchTab(tabs[newIndex].getAttribute('data-tab'));
        }

        // Fechar modais com ESC
        if (e.key === 'Escape') {
            closeAllModals();
        }
    });
}

    // ===== FEATURES AVAN√áADAS =====
    
    // GitHub Integration
async function importFromGitHub() {
    if (!isOnline) {
        showNotification('‚ùå Sem conex√£o com internet para acessar GitHub', 'error');
        return;
    }

    if (!githubRepo) {
        showNotification('Configure o reposit√≥rio GitHub primeiro', 'error');
        showGithubSettings();
        return;
    }

    try {
        showNotification('üì• Importando do GitHub...', 'info');
        
        // ‚úÖ CORRE√á√ÉO: Limpar o reposit√≥rio para remover URL completa
        const cleanRepo = githubRepo
            .replace('https://github.com/', '')
            .replace('.git', '')
            .trim();
        
        const response = await fetch(`https://api.github.com/repos/${cleanRepo}/contents`, {
            headers: githubToken ? { 'Authorization': `token ${githubToken}` } : {}
        });

        if (!response.ok) {
            throw new Error('Erro ao acessar reposit√≥rio');
        }

        const contents = await response.json();
        await processGitHubContents(contents);
        
        showNotification('‚úÖ Reposit√≥rio importado com sucesso!', 'success');
    } catch (error) {
        console.error('Erro GitHub:', error);
        showNotification('‚ùå Erro ao importar do GitHub', 'error');
    }
}

    // tests.js - Testes unit√°rios para fun√ß√µes cr√≠ticas

class CodeEditorTests {
    constructor() {
        this.passed = 0;
        this.failed = 0;
    }

    logTest(name, result) {
        if (result) {
            console.log(`‚úÖ ${name}`);
            this.passed++;
        } else {
            console.log(`‚ùå ${name}`);
            this.failed++;
        }
    }

    // Teste da fun√ß√£o getFileType
    testGetFileType() {
        const testCases = [
            { input: 'test.html', expected: 'html' },
            { input: 'style.css', expected: 'css' },
            { input: 'script.js', expected: 'js' },
            { input: 'data.json', expected: 'json' },
            { input: 'unknown.xyz', expected: 'text' }
        ];

        testCases.forEach(test => {
            const result = getFileType(test.input);
            this.logTest(`getFileType("${test.input}")`, result === test.expected);
        });
    }

    // Teste da fun√ß√£o getFileIcon
    testGetFileIcon() {
        const testCases = [
            { input: 'test.html', expected: 'üåê' },
            { input: 'style.css', expected: 'üé®' },
            { input: 'script.js', expected: '‚ö°' },
            { input: 'unknown.xyz', expected: 'üìÑ' }
        ];

        testCases.forEach(test => {
            const result = getFileIcon(test.input);
            this.logTest(`getFileIcon("${test.input}")`, result === test.expected);
        });
    }

    // Teste do sistema de notifica√ß√µes
    testNotificationSystem() {
        try {
            showNotification('Teste', 'success');
            this.logTest('Sistema de notifica√ß√µes', true);
        } catch (error) {
            this.logTest('Sistema de notifica√ß√µes', false);
        }
    }

    // Teste do debounce
    testDebounce() {
        let counter = 0;
        const increment = debounce(() => counter++, 10);
        
        increment();
        increment();
        increment();
        
        setTimeout(() => {
            this.logTest('Fun√ß√£o debounce', counter === 1);
        }, 50);
    }

    // Teste de formata√ß√£o de c√≥digo
    testCodeFormatting() {
        const testHTML = '<div><p>test</p></div>';
        const formatted = formatHTML(testHTML);
        this.logTest('Formata√ß√£o HTML', formatted.includes('\n'));
    }

    runAllTests() {
        console.log('üß™ INICIANDO TESTES UNIT√ÅRIOS...\n');
        
        this.testGetFileType();
        this.testGetFileIcon();
        this.testNotificationSystem();
        this.testDebounce();
        this.testCodeFormatting();
        
        console.log('\nüìä RESULTADO DOS TESTES:');
        console.log(`‚úÖ Passados: ${this.passed}`);
        console.log(`‚ùå Falhados: ${this.failed}`);
        console.log(`üìà Cobertura: ${((this.passed / (this.passed + this.failed)) * 100).toFixed(1)}%`);
        
        return this.failed === 0;
    }
}

// Adicione ao final do script.js para executar testes
function runEditorTests() {
    if (DEBUG_MODE) {
        const tests = new CodeEditorTests();
        return tests.runAllTests();
    }
    return true;
}

    async function processGitHubContents(contents, path = '') {
        for (const item of contents) {
            if (item.type === 'dir') {
                const folderName = item.name;
                if (!folders[folderName]) {
                    folders[folderName] = {
                        handle: null,
                        files: {}
                    };
                }
                
                const dirResponse = await fetch(item.url, {
                    headers: githubToken ? { 'Authorization': `token ${githubToken}` } : {}
                });
                const dirContents = await dirResponse.json();
                await processGitHubContents(dirContents, folderName);
                
            } else if (item.type === 'file') {
                await processGitHubFile(item, path);
            }
        }
        
        saveToLocalStorage();
        loadFolders();
    }

    async function processGitHubFile(file, folderName = 'root') {
        const fileName = file.name.replace(/\.[^/.]+$/, "");
        const fileType = getFileType(file.name);
        
        if (!fileType) return;
        
        try {
            const fileResponse = await fetch(file.download_url);
            const content = await fileResponse.text();
            
            if (!folders[folderName]) {
                folders[folderName] = {
                    handle: null,
                    files: {}
                };
            }
            
            if (!folders[folderName].files[fileName]) {
                folders[folderName].files[fileName] = {};
            }
            
            folders[folderName].files[fileName][fileType] = content;
            
        } catch (error) {
            console.warn(`Erro ao processar arquivo ${file.name}:`, error);
        }
    }

    async function exportToGitHub() {
        if (!isOnline) {
            showNotification('‚ùå Sem conex√£o com internet para acessar GitHub', 'error');
            return;
        }

        if (!githubRepo) {
            showNotification('Configure o reposit√≥rio GitHub primeiro', 'error');
            showGithubSettings();
            return;
        }

        try {
            showNotification('üì§ Exportando para GitHub...', 'info');
        
            // Para exporta√ß√£o, voc√™ precisaria de uma implementa√ß√£o mais complexa
            // usando a API do GitHub para criar/atualizar arquivos
            // Esta √© uma implementa√ß√£o b√°sica de exemplo
        
            const exportData = {
                timestamp: new Date().toISOString(),
                files: folders
            };
        
            showNotification('‚ö†Ô∏è Exporta√ß√£o para GitHub em desenvolvimento. Dados prontos no console.', 'info');
            console.log('Dados para exportar:', exportData);
        
        } catch (error) {
            console.error('Erro ao exportar para GitHub:', error);
            showNotification('‚ùå Erro ao exportar para GitHub', 'error');
        }
    }

    // Busca avan√ßada
    function advancedSearch(searchTerm) {
        const results = [];
        
        for (const folderName in folders) {
            const folder = folders[folderName];
            
            for (const fileName in folder.files) {
                const file = folder.files[fileName];
                let fileContent = '';
                
                for (const lang in file) {
                    if (lang !== 'handle' && file[lang]) {
                        fileContent += file[lang] + ' ';
                    }
                }
                
                if (fileName.toLowerCase().includes(searchTerm) || 
                    fileContent.toLowerCase().includes(searchTerm)) {
                    results.push({
                        folder: folderName,
                        file: fileName,
                        matches: countMatches(fileContent, searchTerm)
                    });
                }
            }
        }
        
        return results.sort((a, b) => b.matches - a.matches);
    }

    function countMatches(content, searchTerm) {
        const regex = new RegExp(searchTerm, 'gi');
        return (content.match(regex) || []).length;
    }

    function displaySearchResults(results) {
        fileList.innerHTML = '';
        
        if (results.length === 0) {
            fileList.innerHTML = '<div class="empty-state">Nenhum resultado encontrado</div>';
            return;
        }
        
        results.forEach(result => {
            const fileElement = document.createElement('div');
            fileElement.className = 'file-item search-result';
            fileElement.innerHTML = `
                <div>
                    ${getFileIcon(result.file)} ${result.file} 
                    <small>(${result.folder})</small>
                    <span class="match-count">${result.matches} üîç</span>
                </div>
            `;
            
            fileElement.addEventListener('click', () => {
                selectFile(result.folder, result.file);
                document.getElementById('fileSearch').value = '';
            });
            
            fileList.appendChild(fileElement);
        });
    }

    // Formata√ß√£o de c√≥digo
    function advancedFormatCode() {
        const editor = getActiveEditor();
        if (!editor) return;
        
        let code = editor.textContent;
        
        try {
            switch(activeTab) {
                case 'html':
                    code = formatHTML(code);
                    break;
                case 'css':
                    code = formatCSS(code);
                    break;
                case 'js':
                    code = formatJavaScript(code);
                    break;
                case 'json':
                    code = JSON.stringify(JSON.parse(code), null, 2);
                    break;
                case 'python':
                    code = formatPython(code);
                    break;
                default:
                    showNotification('Formata√ß√£o n√£o dispon√≠vel para esta linguagem', 'info');
                    return;
            }
            
            editor.textContent = code;
            updateSyntaxHighlighting();
            showNotification('‚ú® C√≥digo formatado!', 'success');
        } catch (error) {
            console.error('Erro na formata√ß√£o:', error);
            showNotification('‚ùå Erro ao formatar c√≥digo', 'error');
        }
    }

    function formatHTML(html) {
        return html
            .replace(/\s*>\s*</g, '>\n<')
            .replace(/\s*>\s*/g, '>\n')
            .replace(/\s*<\s*/g, '\n<')
            .replace(/\n\s*\n/g, '\n')
            .trim();
    }

    function formatCSS(css) {
        return css
            .replace(/\s*{\s*/g, ' {\n    ')
            .replace(/;\s*/g, ';\n    ')
            .replace(/,\s*/g, ', ')
            .replace(/\s*}\s*/g, '\n}\n\n')
            .replace(/\s*:\s*/g, ': ')
            .trim();
    }

    function formatJavaScript(js) {
        return js
            .replace(/\s*{\s*/g, ' {\n    ')
            .replace(/;\s*/g, ';\n    ')
            .replace(/\s*}\s*/g, '\n}\n\n')
            .replace(/\s*\(\s*/g, '(')
            .replace(/\s*\)\s*/g, ')')
            .replace(/\s*,\s*/g, ', ');
    }

    function formatPython(py) {
        return py
            .replace(/\n\s*\n\s*\n/g, '\n\n')
            .trim();
    }

    function updateSyntaxHighlighting() {
        document.querySelectorAll('.code-editor:not(.hidden)').forEach(editor => {
            Prism.highlightElement(editor);
        });
    }

    // Atalhos de teclado
    function setupKeyboardShortcuts() {
        document.addEventListener('keydown', (e) => {
            // Ctrl+S para salvar
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveCurrentFile();
            }
            
            // Ctrl+F para buscar
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                const findBar = document.getElementById('findBar');
                if (findBar) {
                    findBar.classList.remove('hidden');
                    document.getElementById('findInput').focus();
                }
            }
        });
    }

    // Auto-complete b√°sico
    function setupAutoComplete() {
        const editors = document.querySelectorAll('.code-editor');
        
        editors.forEach(editor => {
            editor.addEventListener('input', (e) => {
                handleAutoComplete(e, editor);
            });
        });
    }

    function handleAutoComplete(event, editor) {
        // Implementa√ß√£o b√°sica de auto-complete
        const cursorPosition = editor.selectionStart;
        const textBeforeCursor = editor.value.substring(0, cursorPosition);
        
        if (activeTab === 'html') {
            const lastOpenBracket = textBeforeCursor.lastIndexOf('<');
            if (lastOpenBracket !== -1) {
                const tagContent = textBeforeCursor.substring(lastOpenBracket + 1);
                if (tagContent.length > 0 && !tagContent.includes('>')) {
                    console.log('Sugerir tag:', tagContent);
                }
            }
        }
    }

    // ===== INICIALIZA√á√ÉO =====
    
    function setupEventListeners() {
        // Menu Hamb√∫rguer
        hamburgerBtn.addEventListener('click', toggleSidebar);
        closeSidebar.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', closeAllModals);
        
        // Alternar entre abas de c√≥digo
        codeTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                switchTab(this.getAttribute('data-tab'));
            });
        });
        
        // Preview
        previewBtn.addEventListener('click', function() {
            showPreview();
            optimizedUpdatePreview();
        });
        closeBtn.addEventListener('click', hidePreview);
        
        // Salvar
        saveBtn.addEventListener('click', saveCurrentFile);
        
        // Sistema de arquivos
        newFolderBtn.addEventListener('click', showNewFolderModal);
        newFileBtn.addEventListener('click', showNewFileModal);
        requestPermissionBtn.addEventListener('click', requestFileSystemPermission);
        exportBtn.addEventListener('click', exportAllFiles);
        importBtn.addEventListener('click', importFiles);
        
        

        // Handler para refreshBtn
        document.getElementById('refreshBtn').addEventListener('click', function() {
            if (directoryHandle) {
                scanDirectory();
                showNotification('üîÑ Pastas atualizadas!');
            } else {
                showNotification('Selecione uma pasta primeiro!', 'error');
            }
        });

                // GitHub - Event listeners atualizados
        document.getElementById('githubBtn').addEventListener('click', function() {
            if (!isOnline) {
                showNotification('üåê Conecte-se √† internet para usar GitHub', 'warning');
                return;
            }
            showGithubSettings();
        });

        document.getElementById('githubImportBtn').addEventListener('click', importFromGitHub);
        document.getElementById('githubExportBtn').addEventListener('click', exportToGitHub);
        document.getElementById('confirmGithubBtn').addEventListener('click', saveGithubSettings);
        document.getElementById('cancelGithubBtn').addEventListener('click', hideGithubModal);
        document.getElementById('closeGithubBtn').addEventListener('click', hideGithubModal);
        
        // Formatador de c√≥digo
        document.getElementById('formatBtn').addEventListener('click', advancedFormatCode);
        
        // Busca em arquivos
        document.getElementById('fileSearch').addEventListener('input', debounce(function(e) {
            const term = e.target.value.trim();
            if (term.length >= 2) {
                const results = advancedSearch(term.toLowerCase());
                displaySearchResults(results);
            } else {
                loadFiles(currentFolder);
            }
        }, 500));

        // Modais
        confirmFolderBtn.addEventListener('click', createFolder);
        cancelFolderBtn.addEventListener('click', hideFolderModal);
        confirmFileBtn.addEventListener('click', createFile);
        cancelFileBtn.addEventListener('click', hideFileModal);

        confirmImportBtn.addEventListener('click', handleImportConfirm);
        cancelImportBtn.addEventListener('click', hideImportModal);
        
        // Capturar mensagens do iframe
        window.addEventListener('message', handleConsoleMessage);
        
        // Salvamento autom√°tico para todas as linguagens
        const debouncedSave = debounce(() => {
            if (currentFileObj) {
                saveCurrentFile();
            }
        }, 2000);

        htmlEditor.addEventListener('input', debouncedSave);
        cssEditor.addEventListener('input', debouncedSave);
        jsEditor.addEventListener('input', debouncedSave);
        pythonEditor.addEventListener('input', debouncedSave);
        phpEditor.addEventListener('input', debouncedSave);
        sqlEditor.addEventListener('input', debouncedSave);
        jsonEditor.addEventListener('input', debouncedSave);
        markdownEditor.addEventListener('input', debouncedSave);

         // Adicionar event listeners para bot√µes que estavam faltando
    const themeBtn = document.getElementById('themeBtn');
    const githubBtn = document.getElementById('githubBtn');
    const snippetsBtn = document.getElementById('snippetsBtn');
    
    if (themeBtn) {
        themeBtn.addEventListener('click', function() {
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            currentTheme = newTheme;
            this.textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
        });
    }
    
    if (githubBtn) {
        githubBtn.addEventListener('click', function() {
            const githubModal = document.getElementById('githubModal');
            if (githubModal) {
                githubModal.classList.add('active');
                overlay.classList.add('active');
            }
        });
    }
    
    if (snippetsBtn) {
        snippetsBtn.addEventListener('click', function() {
            const snippetsModal = document.getElementById('snippetsModal');
            if (snippetsModal) {
                snippetsModal.classList.add('active');
                overlay.classList.add('active');
            }
        });
    }
    
    // Fechar modais do GitHub e Snippets
    const closeGithubBtn = document.getElementById('closeGithubBtn');
    const closeSnippetsBtn = document.getElementById('closeSnippetsBtn');
    
    if (closeGithubBtn) {
        closeGithubBtn.addEventListener('click', function() {
            document.getElementById('githubModal').classList.remove('active');
            overlay.classList.remove('active');
        });
    }
    
    if (closeSnippetsBtn) {
        closeSnippetsBtn.addEventListener('click', function() {
            document.getElementById('snippetsModal').classList.remove('active');
            overlay.classList.remove('active');
        });
    }

    }

    function applyTheme(theme) {
        document.body.className = theme + '-theme';
        localStorage.setItem('codeEditorTheme', theme);
    }

    function initAdvancedFeatures() {
        const savedGithubRepo = localStorage.getItem('githubRepo');
        const savedGithubToken = localStorage.getItem('githubToken');
        
        if (savedGithubRepo) githubRepo = savedGithubRepo;
        if (savedGithubToken) githubToken = savedGithubToken;
        
        console.log('Features avan√ßadas inicializadas');
    }

    function init() {
        setupEventListeners();
        setupMobileOptimizations();
        setupSidebarGestures();
        updatePermissionStatus();
        loadFromLocalStorage();
        initAdvancedFeatures();
        setupKeyboardShortcuts();
        setupAutoComplete();

        // NOVAS INICIALIZA√á√ïES
        initializeLazyLoading();
        setupAccessibility();
        setupKeyboardNavigation();

        // Configurar monitoramento de conex√£o
        setupConnectionMonitoring();

        // Inicializar snippets
        loadSnippets();
        
        // Carregar tema salvo
        const savedTheme = localStorage.getItem('codeEditorTheme') || 'dark';
        applyTheme(savedTheme);
        
        showNotification('üöÄ CodeMobile 2.0 carregado com features avan√ßadas!', 'success');
    }

    // ===== COMPATIBILIDADE E EXPORTA√á√ÉO =====
    
    function getActiveEditor() {
        return document.querySelector(`#${activeTab}Editor`);
    }

    

    // ===== INICIALIZA√á√ÉO FINAL =====
    
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar elementos do DOM
        htmlEditor = document.getElementById('htmlEditor');
        cssEditor = document.getElementById('cssEditor');
        jsEditor = document.getElementById('jsEditor');
        pythonEditor = document.getElementById('pythonEditor');
        phpEditor = document.getElementById('phpEditor');
        sqlEditor = document.getElementById('sqlEditor');
        jsonEditor = document.getElementById('jsonEditor');
        markdownEditor = document.getElementById('markdownEditor');
        previewFrame = document.getElementById('previewFrame');
        consoleOutput = document.getElementById('consoleOutput');
        previewBtn = document.getElementById('previewBtn');
        closeBtn = document.getElementById('closeBtn');
        previewArea = document.getElementById('previewArea');
        overlay = document.getElementById('overlay');
        codeTabs = document.querySelectorAll('.code-tab');
        saveBtn = document.getElementById('saveBtn');
        hamburgerBtn = document.getElementById('hamburgerBtn');
        closeSidebar = document.getElementById('closeSidebar');
        sidebar = document.getElementById('sidebar');
        editorContainer = document.getElementById('editorContainer');
        
        // Elementos do sistema de arquivos
        newFolderBtn = document.getElementById('newFolderBtn');
        newFileBtn = document.getElementById('newFileBtn');
        requestPermissionBtn = document.getElementById('requestPermissionBtn');
        permissionIndicator = document.getElementById('permissionIndicator');
        permissionText = document.getElementById('permissionText');
        folderList = document.getElementById('folderList');
        fileList = document.getElementById('fileList');
        currentFileElement = document.getElementById('currentFile');
        currentFolderTitle = document.getElementById('currentFolderTitle');
        exportBtn = document.getElementById('exportBtn');
        importBtn = document.getElementById('importBtn');
        
        // Modais
        folderModal = document.getElementById('folderModal');
        fileModal = document.getElementById('fileModal');
        folderNameInput = document.getElementById('folderNameInput');
        fileNameInput = document.getElementById('fileNameInput');
        confirmFolderBtn = document.getElementById('confirmFolderBtn');
        cancelFolderBtn = document.getElementById('cancelFolderBtn');
        confirmFileBtn = document.getElementById('confirmFileBtn');
        cancelFileBtn = document.getElementById('cancelFileBtn');
        importModal = document.getElementById('importModal');
        importFileInput = document.getElementById('importFileInput');
        confirmImportBtn = document.getElementById('confirmImportBtn');
        cancelImportBtn = document.getElementById('cancelImportBtn');

        // Inicializar a aplica√ß√£o
        init();
        
        console.log('üåà CodeMobile 2.0 carregado com sucesso!');
    });


   // service-worker.js
const CACHE_NAME = 'codemobile-v2.0';
const urlsToCache = [
    './',
    './index.html',
    './styles.css',
    './script.js',
    './snippets.js'
];

self.addEventListener('install', function(event) {
    event.waitUntil(
        caches.open(CACHE_NAME)
            .then(function(cache) {
                console.log('Cache aberto');
                return cache.addAll(urlsToCache);
            })
    );
});

self.addEventListener('fetch', function(event) {
    event.respondWith(
        caches.match(event.request)
            .then(function(response) {
                // Retorna do cache ou faz fetch
                return response || fetch(event.request);
            })
    );
});
    </script>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
